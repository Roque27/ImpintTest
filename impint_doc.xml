<?xml version="1.0" encoding="iso-8859-1"?>
<qry:doc-definition xmlns:qry="lg.lan/qry" name="ejemplo simple">
    <qry:declare>

        <!-- Variables globales -->
        <qry:variable name="Imputacion_Incobrables" type="integer" value="0"/>
        <qry:variable name="OrdenDesde" type="integer" value="9999999"/>
        <qry:variable name="OrdenHasta" type="integer" value="0"/>
        <qry:variable name="sec_codigo" type="string" value="0"/>
        <qry:variable name="tor_grupo" type="integer" value="0"/>
        <qry:variable name="hay_datos_geograficos" type="integer" value="0"/>
        <qry:variable name="psal" type="integer" value="0"/>
        <qry:variable name="not_codigo" type="string" value="0"/>
        <qry:variable name="nro_ord" type="integer" value="0"/>
        <qry:variable name="CantidadDeFacturas" type="integer" value="0"/>

        <qry:variable name="Tor_codigo" type="string"/>
        <qry:variable name="s_srv_agf_nombre" type="string"/>
        <qry:variable name="sysdate" type="string"/>
        
        <qry:variable name="l_usr_numero" type="integer"/>
        <qry:variable name="l_tim_codigo" type="string"/>
        <qry:variable name="l_crr_genera_planilla" type="string"/>
        <qry:variable name="l_crr_archivo_lote" type="string"/>
        <qry:variable name="l_crr_archivo_lote_path" type="string"/>
        <qry:variable name="l_cpr_numero" type="integer"/>
        <qry:variable name="l_est_codigo" type="string"/>
        <qry:variable name="l_prox_est_codigo" type="string"/>
        <qry:variable name="l_o_prs_numero" type="string"/>
        
        <qry:variable name="Escribi" type="integer" value="0"/>
        <qry:variable name="domicilio_fiscal_full" type="string" value=""/>
        <qry:variable name="bar_code" type="string"/>
        <qry:variable name="nro_ord" type="integer"/>
        <qry:variable name="nrobarra" type="integer"/>
        <qry:variable name="srv_cod" type="integer"/>
        <qry:variable name="cnt_num" type="integer"/>
        <qry:variable name="trt_num" type="integer"/>

        <qry:variable name="ban" type="integer"/>

        <!-- Bucle principal -->

        <qry:variable name="prs_num" type="string"/> <!-- OK -->
        <qry:variable name="prs_razon_social" type="string"/>
        <qry:variable name="prs_direccion" type="string"/>
        <qry:variable name="cfc_codigo" type="string"/>
        <qry:variable name="prs_calle" type="string" value="0"/>
        <qry:variable name="prs_nro" type="string" value="0"/>
        <qry:variable name="prs_piso" type="string" value="0"/>
        <qry:variable name="prs_depto" type="string" value="0"/>
        <qry:variable name="prs_torreo" type="string" value="0"/>
        <qry:variable name="prs_c_postal" type="string" value="0"/>
        <qry:variable name="prs_agf_nombre" type="string" value="0"/>
        <qry:variable name="cll_nombre" type="string" value="0"/>
        <qry:variable name="cnt_nro_pago" type="string"/>
        <qry:variable name="cnt_bis" type="string"/>
        <qry:variable name="cnt_piso_pago" type="string"/>
        <qry:variable name="cnt_depto_pago" type="string"/>
        <qry:variable name="cnt_c_postal_pago" type="string"/>
        <qry:variable name="cnt_agf_nombre" type="string"/>
        <qry:variable name="cll_nombre_completo" type="string" value="0"/>

        <!-- Estructuras llenas -->

        <qry:variable name="TBL_documentos" type="data"/>
        <qry:variable name="TBL_personas" type="data"/>
        <qry:variable name="TBL_contratos" type="data"/>
        <qry:variable name="TBL_servicios" type="data"/>
        <qry:variable name="TBL_lecturas" type="data"/>
        <qry:variable name="TBL_ordenativos" type="data"/>
        <qry:variable name="TBL_potencias" type="data"/>
        <qry:variable name="TBL_stock_equipos" type="data"/>
        <qry:variable name="TBL_sucursales" type="data"/>
        <qry:variable name="TBL_bancos" type="data"/>
        <qry:variable name="TBL_cargos" type="data"/>
        <qry:variable name="TBL_tarifas" type="data"/>
        <qry:variable name="TBL_tipos_iva" type="data"/>
        <qry:variable name="TBL_totales_tramites" type="data"/>

        <!-- Banderas estructuras llenas -->

        <qry:variable name="actual_prs_numero" type="integer"/>
        <qry:variable name="actual_srv_cod" type="integer"/>
        <qry:variable name="actual_scf_cod" type="integer"/>
        <qry:variable name="actual_nro_ord" type="integer"/>
        <qry:variable name="actual_agf_cod" type="integer"/>
        <qry:variable name="actual_ivv_cod" type="integer"/>
        <qry:variable name="actual_tcl_cod" type="integer"/>
        <qry:variable name="actual_trt_num" type="integer"/>

        <qry:variable name="isEmpty_documentos_doc" type="integer" value="0"/>
        <qry:variable name="isEmpty_documentos_ori" type="integer" value="0"/>
        <qry:variable name="isEmpty_personas" type="integer" value="0"/>
        <qry:variable name="isEmpty_contratos" type="integer" value="0"/>
        <qry:variable name="isEmpty_servicios" type="integer" value="0"/>
        <qry:variable name="isEmpty_lecturas" type="integer" value="0"/>
        <qry:variable name="isEmpty_ordenativos" type="integer" value="0"/>
        <qry:variable name="isEmpty_potencias" type="integer" value="0"/>
        <qry:variable name="isEmpty_stock_equipos" type="integer" value="0"/>
        <qry:variable name="isEmpty_sucursales" type="integer" value="0"/>
        <qry:variable name="isEmpty_bancos" type="integer" value="0"/>
        <qry:variable name="isEmpty_cargos" type="integer" value="0"/>
        <qry:variable name="isEmpty_tarifas" type="integer" value="0"/>
        <qry:variable name="isEmpty_tipos_iva" type="integer" value="0"/>
        <qry:variable name="isEmpty_totales_tramites" type="integer" value="0"/>

        <!-- Notifi -->
        
        <qry:variable name="v_columna" type="string"/>
        <qry:variable name="largos" type="integer" value="0"/>
        <qry:variable name="campo" type="string"/>
        <qry:variable name="l_tor_descripcion" type="string"/>
        <qry:variable name="document_tbl_type" type="string"/>
        <qry:variable name="eno_col" type="double"/>

        <qry:variable name="srv_cod_temp" type="integer"/>
        <qry:variable name="cnt_num_temp" type="integer"/>
        <qry:variable name="trt_num_temp" type="integer"/>
        <qry:variable name="prs_num_temp" type="integer"/>

        <qry:variable name="v_tabla" type="string"/>
        <qry:variable name="v_columna" type="string"/>

        <!-- Personas -->

        <!-- Contratos -->
        <qry:variable name="ivv_codigo" type="string"/>
        <qry:variable name="tcl_cod" type="string"/>

        <!-- Servicios -->

        <!-- Lecturas -->

        <!-- Ordenativos -->

        <!-- Potencias -->
        
        <!-- Sucursales -->
        <qry:variable name="scf_cod" type="integer"/>

        <!-- Bancos -->
        <qry:variable name="agf_cod" type="integer"/>

        <!-- Cargos -->
        <qry:variable name="v_descripcion" type="string"/>
        <qry:variable name="ord_fec" type="string" value="0"/>
        
        <!-- Tipos_IVA -->
        <qry:variable name="ivv_cod" type="integer"/>

        <!-- Tarifas -->

        <!-- Documentos -->
        <qry:variable name="t_doc_saldo" type="double" value="0"/>
        <qry:variable name="num_rows_doc" type="integer" value="20"/>  <!-- El valor ya esta hardcodeado -->
        <qry:variable name="nro_linea" type="integer" value="0"/>
        <qry:variable name="Tiene_Comprobantes_Financiaciones" type="integer" value="0"/>
        <qry:variable name="Tiene_Otros_Comprobantes" type="integer" value="0"/>
        <qry:variable name="ImporteDelAviso" type="double" value="0"/>
        <qry:variable name="ImporteDelAvisoGeneraReporte" type="integer"/>

        <!-- Totales_Tramite -->
        
        <!-- Usuarios -->
        
        <!-- Prs_Num_Ori -->

        <!-- SelectCodigoBarras -->
        
        <!-- Buscar_Codigos_Control -->
        <qry:variable name="v_tim_codigo" type="string"/>
        
        <!-- TEST -->
        <qry:variable name="TESTmain" type="integer" value="0"/>
        <qry:variable name="TESTnotifi" type="integer" value="0"/>
  
    </qry:declare>
    <qry:main>
         <!-- No posee select propio -->
        <qry:out>
            
            <qry:element name="Impint">
            <!--
            <qry:print output="stdout" value="PARAMETROS"/>
            <qry:print output="stdout" value="NOMBREARCHIVO: {#PARAM:/IMPINT_PARAM/NOMBREARCHIVO/@PARAMFILE}"/>
            <qry:print output="stdout" value="REPORTE: {#PARAM:/IMPINT_PARAM/REPORTE/@PARAMREPCODIGO}"/>
            <qry:print output="stdout" value="INCOBRABLES: {#PARAM:/IMPINT_PARAM/INCOBRABLES/@PARAMINCOBRABLES}"/>
            <qry:print output="stdout" value="USER: {#PARAM:/IMPINT_PARAM/USER/@PARAMUSER}"/>
            <qry:print output="stdout" value="PRINT: {#PARAM:/IMPINT_PARAM/PRINT/@PARAMIMPR}"/>
            <qry:print output="stdout" value="TIPOCORREO: {#PARAM:/IMPINT_PARAM/TIPOCORREO/@PARAMCODTIPOCORREO}" />
            <qry:print output="stdout" value="CORREO: {#PARAM:/IMPINT_PARAM/CORREO/@PARAMCODCORREO}" />
            <qry:print output="stdout" value="TOR_CODIGO: {#PARAM:/IMPINT_PARAM/TOR_CODIGO/@PARAMTORCOD}" />
            <qry:print output="stdout" value="SUC: {#PARAM:/IMPINT_PARAM/SUC/@PARAMSUC}" />
            <qry:print output="stdout" value="SEC: {#PARAM:/IMPINT_PARAM/SEC/@PARAMSEC}" />
            <qry:print output="stdout" value="ORD_DESDE: {#PARAM:/IMPINT_PARAM/ORD_DESDE/@PARAMORDDSD}" />
            <qry:print output="stdout" value="ORD_HASTA: {#PARAM:/IMPINT_PARAM/ORD_HASTA/@PARAMORDHST}"/>
            -->
            <qry:insert-query name="Main" doc-param="#PARAM:"/>
              
            </qry:element>
        </qry:out>
    </qry:main>

    <!-- MAIN -->
    
    <qry:query name="Main">
        <qry:select>
            SELECT o.trt_numero
              ,o.ord_numero
              ,o.srv_codigo AS SRV_CODIGO
              ,o.cnt_numero
              ,nvl(o.tor_codigo, '') AS TOR_CODIGO
              ,to_char(o.ord_fecha_generacion, 'dd/mm/yyyy') AS ORD_FECHA_GENERACION
              ,u.scf_codigo
              ,COALESCE(o.sec_codigo_origen, '0') AS SEC_CODIGO_ORIGEN
              ,COALESCE(t.tor_grupo, '0') AS TOR_GRUPO
              ,t.tor_descripcion
              ,COALESCE(o.prs_numero, 0) AS PRS_NUMERO
              ,o.rowid
              ,o.crr_tipo
              ,o.crr_codigo
            FROM ordenativos o
            INNER JOIN tipos_ordenativo t
                  ON o.tor_codigo = t.tor_codigo
            CROSS JOIN usuarios u
            WHERE t.tor_codigo = {#PARAM:/IMPINT_PARAM/TOR_CODIGO/@PARAMTORCOD}
              AND u.usr_codigo = {#PARAM:/IMPINT_PARAM/USER/@PARAMUSER}
              AND o.scf_codigo_origen = {#PARAM:/IMPINT_PARAM/SUC/@PARAMSUC}
              AND o.sec_codigo_origen = {#PARAM:/IMPINT_PARAM/SEC/@PARAMSEC}
              AND o.ord_numero BETWEEN {#PARAM:/IMPINT_PARAM/ORD_DESDE/@PARAMORDDSD} AND {#PARAM:/IMPINT_PARAM/ORD_HASTA/@PARAMORDHST}
              AND o.crr_tipo = {#PARAM:/IMPINT_PARAM/TIPOCORREO/@PARAMCODTIPOCORREO}
              AND o.crr_codigo = {#PARAM:/IMPINT_PARAM/CORREO/@PARAMCODCORREO}
              
              <!-- AND o.ord_situacion = 'P'-->
              AND o.ord_estado = 'D'
            ORDER BY o.ord_numero
        </qry:select>
        <qry:out>
            <qry:if left="#PARAM:/IMPINT_PARAM/INCOBRABLES/@PARAMINCOBRABLES" operator="equal" right="S" type="string">
                <qry:set-variable name="Imputacion_Incobrables" value="1"/>
            </qry:if>
            <qry:insert-query name="SeleccionaPersona" doc-param="#PARAM:"/>
            <qry:insert-query name="SeleccionaImpresora" doc-param="#PARAM:"/>
            <qry:insert-query name="CargaPlantillas" doc-param="#PARAM:"/>
            <qry:insert-query name="CargaProxNroProceso"/>
            <qry:if left="{$l_crr_genera_planilla}" operator="equal" right="0" type="string">
                <qry:set-variable name="l_crr_genera_planilla" value="N"/>
            </qry:if>
            <qry:insert-query name="SeleccionaFechaActual"/>
            <qry:insert-query name="SeleccionaEstadoInicial"/>
            <!-- INSERT Control de procesos salida-->
            <qry:element name="SqlCommand">
                <qry:attribute name="type" value="INSERT"/>
                <qry:attribute name="id" value="1"/>
                <qry:text value="INSERT INTO control_procesos (cpr_numero,cpr_tipo_proceso,usr_numero_incorpora,prc_codigo,est_codigo,cpr_fecha_inicio) VALUES({$l_cpr_numero}, 'IN', {$l_usr_numero}, 'IN', '{$l_est_codigo}', '{$sysdate}'); "/>
                <!--<qry:element name="control_procesos">
                    <qry:attribute name="cpr_numero" value="{$l_cpr_numero}"/>
                    <qry:attribute name="cpr_tipo_proceso" value="IN"/>
                    <qry:attribute name="usr_numero_incorpora" value="{$l_usr_numero}"/>
                    <qry:attribute name="prc_codigo" value="IN"/>
                    <qry:attribute name="est_codigo" value="{$l_est_codigo}"/>
                    <qry:attribute name="cpr_fecha_inicio" value="{$sysdate}"/>
                </qry:element>-->
            </qry:element>

            <qry:for-each-row>
                
                <qry:set-variable name="TESTmain" value="1" operation="+"/>
                <qry:print output="stdout" value="INICIO BUCLE - Main nro {$TESTmain} "/>
                <qry:set-variable name="srv_cod" value="#ROW:/ROW/@SRV_CODIGO"/>
                <qry:set-variable name="cnt_num" value="#ROW:/ROW/@CNT_NUMERO"/>
                <qry:set-variable name="scf_cod" value="#ROW:/ROW/@SCF_CODIGO"/>
                <qry:set-variable name="trt_num" value="#ROW:/ROW/@TRT_NUMERO"/>
                <qry:set-variable name="nro_ord" value="#ROW:/ROW/@ORD_NUMERO"/>
                <qry:set-variable name="l_tor_descripcion" value="#ROW:/ROW/@TOR_DESCRIPCION"/>
                <qry:set-variable name="hay_datos_geograficos" value="0"/>

                <qry:element name="Reporte">
                    <qry:attribute name="tipo" value="#ROW:/ROW/@TOR_CODIGO"/>
                    <qry:set-variable name="Tiene_Comprobantes_Financiaciones" value="0"/>
                    <qry:set-variable name="Tiene_Otros_Comprobantes" value="0"/>
                    <qry:if left="{#ROW:/ROW/@ORD_NUMERO}" operator="less" right="{$OrdenDesde}" type="integer">
                        <qry:set-variable name="OrdenDesde" value="{#ROW:/ROW/@ORD_NUMERO}"/>
                    </qry:if>
                    <qry:if left="{#ROW:/ROW/@ORD_NUMERO}" operator="greater" right="{$OrdenHasta}" type="integer">
                        <qry:set-variable name="OrdenHasta" value="{#ROW:/ROW/@ORD_NUMERO}"/>
                    </qry:if>

                    <qry:if left="{$sec_codigo}" operator="equal" right="0" type="integer">
                        <qry:if left="{#ROW:/ROW/@SEC_CODIGO_ORIGEN}" operator="not-equal" right="0" type="string">
                            <qry:set-variable name="sec_codigo" value="{#ROW:/ROW/@SEC_CODIGO_ORIGEN}"/>
                        </qry:if>
                    </qry:if>
                    <qry:if left="{$tor_grupo}" operator="equal" right="0" type="integer">
                        <qry:if left="{#ROW:/ROW/@TOR_GRUPO}" operator="not-equal" right="0" type="string">
                            <qry:set-variable name="tor_grupo" value="{#ROW:/ROW/@TOR_GRUPO}"/>
                        </qry:if>
                    </qry:if>

                    <qry:if left="{#ROW:/ROW/@SRV_CODIGO}" operator="equal" right="0" type="integer">
                        <qry:insert-query name="ObtenerDatosSinContrato" doc-param="#ROW:"/>
                    <qry:else/>
                        <qry:insert-query name="ObtenerDatosConContrato" doc-param="#ROW:"/>
                    </qry:if>
                    <qry:if left="{$hay_datos_geograficos}" operator="equal" right="0" type="integer">
                        <qry:insert-query name="ObtenerDatosSiNoHayDatos" doc-param="#ROW:"/>
                        <qry:if left="{$hay_datos_geograficos}" operator="equal" right="0" type="integer">
                            <qry:set-variable name="prs_num" value="0"/>
                        </qry:if>
                    </qry:if>
                    <qry:insert-query name="ObtenerNotCodigo" doc-param="#ROW:"/>
                    <qry:if left="{$not_codigo}" operator="not-equal" right="0" type="string">
                        <qry:set-variable name="ImporteDelAviso" value="0"/>
                        <qry:set-variable name="CantidadDeFacturas" value="0"/>

                        <!-- Proceso Principal -->
                        <qry:insert-query name="Notifi"/>
                        <qry:attribute name="CantidadDeFacturas" value="{$CantidadDeFacturas}"/>
                        <qry:if left="{$CantidadDeFacturas}" operator="greater" right="0" type="integer">
                            <qry:set-variable name="Escribi" value="1" operation="+"/>

                            <!--  
                            <qry:print output="stdout" value="TEEST : {#ROW:/ROW/@ORD_NUMERO}"/>
                            <qry:print output="stdout" value="TEEST : {#ROW:/ROW/@SCF_CODIGO}"/>
                            <qry:print output="stdout" value="TEEST : {$l_cpr_numero}"/>
                            <qry:print output="stdout" value="TEEST : {$ImporteDelAviso}"/>
                            <qry:print output="stdout" value="TEEST : {#ROW:/ROW/@ORD_FECHA_GENERACION}"/>
                            <qry:print output="stdout" value="TEEST : {#ROW:/ROW/@ORD_FECHA_GENERACION}"/>
                            <qry:print output="stdout" value="TEEST : {#ROW:/ROW/@ORD_FECHA_GENERACION}"/>
                            <qry:print output="stdout" value="TEEST : {$prs_razon_social}"/>
                            <qry:print output="stdout" value="TEEST : {$prs_calle}"/>
                            <qry:print output="stdout" value="TEEST : {$prs_nro}"/>
                            <qry:print output="stdout" value="TEEST : {$prs_piso}"/>
                            <qry:print output="stdout" value="TEEST : {$prs_depto}"/>
                            <qry:print output="stdout" value="TEEST : {$cll_nombre_completo}"/>
                            <qry:print output="stdout" value="TEEST : {$cll_nombre}"/>
                            <qry:print output="stdout" value="TEEST : {$cnt_nro_pago}"/>
                            <qry:print output="stdout" value="TEEST : {$cnt_piso_pago}"/>
                            <qry:print output="stdout" value="TEEST : {$cnt_depto_pago}"/>
                            <qry:print output="stdout" value="TEEST : {#ROW:/ROW/@CRR_TIPO}"/>
                            <qry:print output="stdout" value="TEEST : {#ROW:/ROW/@CRR_CODIGO}"/>
                            <qry:print output="stdout" value="TEEST : {$CantidadDeFacturas}"/>
                            <qry:print output="stdout" value="TEEST : {$prs_c_postal}"/>
                            <qry:print output="stdout" value="TEEST : {$prs_agf_nombre}"/>
                            <qry:print output="stdout" value="TEEST : {$cnt_c_postal_pago}"/>
                            <qry:print output="stdout" value="TEEST : {$cnt_agf_nombre}"/>
                            -->
                            
                            <qry:set-variable name="ImporteDelAviso" value="100" operation="*"/>
                            <qry:set-variable name="ImporteDelAvisoGeneraReporte" value="{$ImporteDelAviso}"/>

                            <qry:insert-query name="GeneraArchivo" doc-param="#ROW:"/>

                            <qry:if left="{#ROW:/ROW/@TOR_GRUPO}" operator="equal" right="CD" type="string">
                                <qry:element name="SqlCommand">
                                    <qry:attribute name="type" value="UPDATE"/>
                                    <qry:attribute name="id" value="2"/>
                                    <qry:text value="UPDATE ordenativos SET ord_situacion = 'I' ,cpr_numero = {$l_cpr_numero} WHERE rowid = {#ROW:/ROW/@ROWID}; "/>
                                    <!--<qry:element name="ordenativos">
                                        <qry:attribute name="cpr_numero" value="{$l_cpr_numero}"/>
                                        <qry:element name="WHERE">
                                            <qry:attribute name="rowid" value="{#ROW:/ROW/@ROWID}"/>
                                        </qry:element>
                                    </qry:element>-->
                                </qry:element>
                            <qry:else/>
                                <qry:element name="SqlCommand">
                                    <qry:attribute name="type" value="UPDATE"/>
                                    <qry:attribute name="id" value="3"/>
                                    <qry:text value="UPDATE ordenativos SET cpr_numero = {$l_cpr_numero} WHERE rowid = {#ROW:/ROW/@ROWID}; "/>
                                    <!--<qry:element name="ordenativos">
                                        <qry:attribute name="cpr_numero" value="{$l_cpr_numero}"/>
                                        <qry:element name="WHERE">
                                            <qry:attribute name="rowid" value="{#ROW:/ROW/@ROWID}"/>
                                        </qry:element>
                                    </qry:element>-->
                                </qry:element>
                            </qry:if>

                        <qry:else/>
                            <qry:attribute name="Imputacion_Incobrables" value="{$Imputacion_Incobrables}"/>
                            <qry:if left="{$Imputacion_Incobrables}" operator="not-equal" right="1" type="integer">
                                <qry:element name="SqlCommand">
                                    <qry:attribute name="type" value="UPDATE"/>
                                    <qry:attribute name="id" value="4"/>
                                    <qry:text value="UPDATE ordenativos SET ord_estado = 'A' ,cpr_numero = {$l_cpr_numero} ,ord_datos_anula = 'Anulado Documentos ya pagados - Saldo 0 - No se imprime  ' WHERE rowid = {#ROW:/ROW/@ROWID}; "/>
                                    <!--<qry:element name="ordenativos">
                                        <qry:attribute name="ord_estado" value="A"/>
                                        <qry:attribute name="cpr_numero" value="{$l_cpr_numero}"/>
                                        <qry:attribute name="ord_datos_anula" value="Anulado Documentos ya pagados - Saldo 0 - No se imprime  "/>
                                        <qry:element name="WHERE">
                                            <qry:attribute name="rowid" value="{#ROW:/ROW/@ROWID}"/>
                                        </qry:element>
                                    </qry:element>-->
                                </qry:element>
                            </qry:if>
                        </qry:if>
                    </qry:if>
                </qry:element>
            </qry:for-each-row>

            <qry:if left="{$Escribi}" operator="not-equal" right="0" type="integer">
                <qry:element name="CMD">
                    <!-- <qry:text value="Imprime {#PARAM:/impint_param/NombreArchivo/@paramFile} list={#PARAM:/impint_param/Reporte/@paramRepCodigo}  id={#PARAM:/impint_param/User/@paramUser} dest={#PARAM:/impint_param/Print/@paramImpr} desc=\'P{$l_cpr_numero}_IMPINT_{$not_codigo}\'"/>-->
                </qry:element>
                <qry:element name="CMD">
                    <!-- <qry:text value="rm {#PARAM:/impint_param/NombreArchivo/@paramFile} "/>-->
                </qry:element>
            </qry:if>

            <qry:insert-query name="SeleccionaProxEstado"/>

            <!-- UPDATE Control de procesos salida-->
            <qry:element name="SqlCommand">
                <qry:attribute name="type" value="UPDATE"/>
                <qry:attribute name="id" value="5"/>
                <qry:text value="UPDATE control_procesos SET est_codigo = '{$l_prox_est_codigo}' WHERE cpr_numero = {$l_cpr_numero}; "/>     
                <!--<qry:element name="control_procesos">
                    <qry:attribute name="est_codigo" value="{$l_prox_est_codigo}"/>
                    <qry:element name="WHERE">
                        <qry:attribute name="cpr_numero" value="{$l_cpr_numero}"/>
                    </qry:element>
                </qry:element>-->
            </qry:element>

            <qry:if left="{$l_crr_genera_planilla}" operator="equal" right="S" type="string">
                <qry:insert-query name="GrabaEnReportes"/>
            <qry:else/>
                <qry:if left="l_crr_genera_planilla" operator="equal" right="A" type="string">
                    <qry:insert-query name="GrabaEnReportes"/>
                    <qry:element name="CMD">
                        <qry:text value="Imprime %s list=IMPINT id=%s dest=%s desc=\'P%d_IMPINT_%s\'"/>
                    </qry:element>
                    <!-- Quilombo -->
                <qry:else/>
                    <!-- Quilombo -->
                </qry:if>
            </qry:if>

            <qry:element name="SqlCommand">
                <qry:attribute name="type" value="EXECUTESQL"/>
                <qry:attribute name="id" value="6"/>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="SeleccionaFechaActual" > 
        <qry:select>
            SELECT TO_CHAR(sysdate, 'dd/mm/yyyy') AS FECHA
            FROM DUAL
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="sysdate" value="#ROW:/ROW/@FECHA"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>
    
    <qry:query name="SeleccionaPersona">
        <qry:select>
            SELECT usr_numero
            FROM usuarios
            WHERE usr_codigo = {#PARAM:/IMPINT_PARAM/USER/@PARAMUSER}
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="l_usr_numero" value="#ROW:/ROW/@USR_NUMERO"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="SeleccionaImpresora">
        <qry:select>
            SELECT tim_codigo
            FROM impresoras
            WHERE impresoras.prt_codigo = {#PARAM:/IMPINT_PARAM/PRINT/@PARAMIMPR}
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="l_tim_codigo" value="#ROW:/ROW/@TIM_CODIGO"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="CargaPlantillas">
        <qry:select>
            SELECT COALESCE(crr_genera_planilla, '0') AS CRR_GENERA_PLANILLA
            	,crr_archivo_sql
            	,crr_archivo_sql_path
            FROM correos c
            INNER JOIN usuarios u
            	ON c.scf_codigo = u.scf_codigo
            WHERE usr_codigo = {#PARAM:/IMPINT_PARAM/USER/@PARAMUSER}
            	AND crr_tipo = {#PARAM:/IMPINT_PARAM/TIPOCORREO/@PARAMCODTIPOCORREO}
            	AND crr_codigo = {#PARAM:/IMPINT_PARAM/CORREO/@PARAMCODCORREO}
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="l_crr_genera_planilla" value="#ROW:/ROW/@CRR_GENERA_PLANILLA"/>
                <qry:set-variable name="l_crr_archivo_lote" value="#ROW:/ROW/@CRR_ARCHIVO_SQL"/>
                <qry:set-variable name="l_crr_archivo_lote_path" value="#ROW:/ROW/@CRR_ARCHIVO_SQL_PATH"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="CargaProxNroProceso">
        <qry:select>
            SELECT cpr_numero.nextval AS CPR_NUMERO
            FROM sys.dual
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="l_cpr_numero" value="#ROW:/ROW/@CPR_NUMERO"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="SeleccionaEstadoInicial" > 
        <qry:select>
            SELECT fun_estado_inicial('IN') AS ESTADO
            FROM DUAL
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="l_est_codigo" value="#ROW:/ROW/@ESTADO"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="SeleccionaProxEstado" > 
        <qry:select>
            SELECT fun_proximo_estado('IN', {$l_est_codigo}, 'IM') AS PROX_ESTADO
            FROM DUAL
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="l_prox_est_codigo" value="#ROW:/ROW/@PROX_ESTADO"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="ObtenerDatosSinContrato" > 
        <qry:select  dump="0">
            SELECT personas.prs_numero
            	,substr(personas.prs_razon_social, 1, 25) AS PRS_RAZON_SOCIAL
            	,nvl(personas.prs_direccion, ' ') AS PRS_DIRECCION
            	,personas.cfc_codigo
            	,COALESCE(substr(calles.cll_nombre, 1, 18), '0') AS CLL_NOMBRE
            	,substr(nvl(personas.prs_nro, '    '), 1, 4) AS PRS_NRO
            	,substr(nvl(personas.prs_piso, '  '), 1, 2) AS PRS_PISO
            	,substr(nvl(personas.prs_depto, '   '), 1, 3) AS PRS_DEPTO
            	,nvl(personas.prs_torre, ' ') AS PRS_TORRE
            	,nvl(personas.prs_c_postal, ' ') AS PRS_C_POSTAL
            	,nvl(areas_geograficas.agf_nombre, ' ') AS AGF_NOMBRE
            FROM areas_geograficas 
            INNER JOIN personas 
            	ON areas_geograficas.agf_codigo = personas.agf_codigo
            INNER JOIN calles
            	ON calles.cll_codigo = personas.cll_codigo AND calles.agf_codigo = personas.agf_codigo
            WHERE personas.prs_numero = {#PARAM:/ROW/@PRS_NUMERO}
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="hay_datos_geograficos" value="1" operation="+"/>

                <qry:set-variable name="prs_num" value="{#ROW:/ROW/@PRS_NUMERO}"/>
                <qry:set-variable name="prs_razon_social" value="{#ROW:/ROW/@PRS_RAZON_SOCIAL}"/>
                <qry:set-variable name="prs_direccion" value="{#ROW:/ROW/@PRS_DIRECCION}"/>
                <qry:set-variable name="cfc_codigo" value="{#ROW:/ROW/@CFC_CODIGO}"/>
                <qry:set-variable name="prs_calle" value="{#ROW:/ROW/@CLL_NOMBRE}"/>
                <qry:set-variable name="prs_nro" value="{#ROW:/ROW/@PRS_NRO}"/>
                <qry:set-variable name="prs_piso" value="{#ROW:/ROW/@PRS_PISO}"/>
                <qry:set-variable name="prs_depto" value="{#ROW:/ROW/@PRS_DEPTO}"/>
                <qry:set-variable name="prs_torre" value="{#ROW:/ROW/@PRS_TORRE}"/>
                <qry:set-variable name="prs_c_postal" value="{#ROW:/ROW/@PRS_C_POSTAL}"/>
                <qry:set-variable name="prs_agf_nombre" value="{#ROW:/ROW/@AGF_NOMBRE}"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="ObtenerDatosConContrato" > 
        <qry:select  dump="0">
            SELECT personas.prs_numero
            	,substr(personas.prs_razon_social, 1, 25) AS PRS_RAZON_SOCIAL
            	,nvl(personas.prs_direccion, ' ') AS PRS_DIRECCION
            	,personas.cfc_codigo
            	,COALESCE(substr(calles.cll_nombre, 1, 18), '0') AS CLL_NOMBRE
            	,COALESCE(substr(contratos.cnt_nro_pago, 1, 4), '0') AS CNT_NRO_PAGO
            	,COALESCE(contratos.cnt_bis, '0') AS cnt_bis
            	,COALESCE(substr(contratos.cnt_piso_pago, 1, 2), '0') AS CNT_PISO_PAGO
            	,COALESCE(substr(contratos.cnt_depto_pago, 1, 3), '0') AS CNT_DEPTO_PAGO
            	,COALESCE(nvl(contratos.cnt_c_postal_pago, ' '), '0') AS CNT_C_POSTAL_PAGO
            	,nvl(areas_geograficas.agf_nombre, ' ') AS AGF_NOMBRE
            FROM areas_geograficas
            INNER JOIN contratos
            	ON areas_geograficas.agf_codigo = contratos.agf_codigo
            INNER JOIN personas
            	ON personas.prs_numero = contratos.prs_numero
            INNER JOIN calles
            	ON calles.agf_codigo = contratos.agf_codigo AND calles.cll_codigo = contratos.cll_codigo
            WHERE contratos.srv_codigo = {#PARAM:/ROW/@SRV_CODIGO}
            	AND contratos.cnt_numero = {#PARAM:/ROW/@CNT_NUMERO}
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="hay_datos_geograficos" value="1" operation="+"/>

                <qry:set-variable name="prs_num" value="{#ROW:/ROW/@PRS_NUMERO}"/>
                <qry:set-variable name="prs_razon_social" value="{#ROW:/ROW/@PRS_RAZON_SOCIAL}"/>
                <qry:set-variable name="prs_direccion" value="{#ROW:/ROW/@PRS_DIRECCION}"/>
                <qry:set-variable name="cfc_codigo" value="{#ROW:/ROW/@CFC_CODIGO}"/>
                <qry:set-variable name="cll_nombre" value="{#ROW:/ROW/@CLL_NOMBRE}"/>
                <qry:set-variable name="cnt_nro_pago" value="{#ROW:/ROW/@CNT_NRO_PAGO}"/>
                <qry:set-variable name="cnt_bis" value="{#ROW:/ROW/@CNT_BIS}"/>
                <qry:set-variable name="cnt_piso_pago" value="{#ROW:/ROW/@CNT_PISO_PAGO}"/>
                <qry:set-variable name="cnt_depto_pago" value="{#ROW:/ROW/@CNT_DEPTO_PAGO}"/>
                <qry:set-variable name="cnt_c_postal_pago" value="{#ROW:/ROW/@CNT_C_POSTAL_PAGO}"/>
                <qry:set-variable name="cnt_agf_nombre" value="{#ROW:/ROW/@AGF_NOMBRE}"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="ObtenerDatosSiNoHayDatos" > 
        <qry:select>
            SELECT personas.prs_numero
            	,substr(personas.prs_razon_social, 1, 25) AS PRS_RAZON_SOCIAL
            	,nvl(personas.prs_direccion, ' ') AS PRS_DIRECCION
            	,personas.cfc_codigo
            	,COALESCE(substr(nvl(regexp_replace(contratos.cnt_direccion_pago, '[[:space:]]+', chr(32)), ' '), 1, 27), '0') AS CNT_DIRECCION_PAGO
            FROM contratos
            INNER JOIN personas
            	ON personas.prs_numero = contratos.prs_numero
            WHERE contratos.srv_codigo = {#PARAM:/ROW/@SRV_CODIGO}
            	AND contratos.cnt_numero = {#PARAM:/ROW/@CNT_NUMERO}
        </qry:select>
        <qry:out>
            <qry:for-each-row>
               <qry:set-variable name="hay_datos_geograficos" value="1" operation="+"/>

               <qry:set-variable name="prs_num" value="{#ROW:/ROW/@PRS_NUMERO}"/>
               <qry:set-variable name="prs_razon_social" value="{#ROW:/ROW/@PRS_RAZON_SOCIAL}"/>
               <qry:set-variable name="prs_direccion" value="{#ROW:/ROW/@PRS_DIRECCION}"/>
               <qry:set-variable name="cfc_codigo" value="{#ROW:/ROW/@CFC_CODIGO}"/>
               <qry:set-variable name="cll_nombre_completo" value="{#ROW:/ROW/@CNT_DIRECCION_PAGO}"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="ObtenerNotCodigo"> 
        <qry:select dump="0">
            SELECT COALESCE(not_codigo, '0') AS NOT_CODIGO
            FROM combinaciones_habilitadas_noti
            WHERE tor_codigo = {#PARAM:/ROW/@TOR_CODIGO}
            	AND cfc_codigo = {$cfc_codigo}
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="not_codigo" value="{#ROW:/ROW/@NOT_CODIGO}"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="GeneraArchivo"> 
        <qry:select dump="0">
            SELECT LPAD({#PARAM:/ROW/@ORD_NUMERO}, 8, 0) AS ORD_NUMERO
                ,LPAD({#PARAM:/ROW/@SCF_CODIGO}, 2, '0') AS SCF_CODIGO
                ,LPAD({$l_cpr_numero}, 6, '0') AS CPR_NUMERO
                ,LPAD({$ImporteDelAvisoGeneraReporte}, 9, '0') AS IMPORTE_AVISO
                ,SUBSTR({#PARAM:/ROW/@ORD_FECHA_GENERACION},7,4) AS ANIO
                ,SUBSTR({#PARAM:/ROW/@ORD_FECHA_GENERACION},4,2) AS MES
                ,SUBSTR({#PARAM:/ROW/@ORD_FECHA_GENERACION},1,2) AS DIA
                ,{$prs_razon_social} AS RAZON_SOCIAL
                ,{$prs_calle} AS CALLE
                ,{$prs_nro} AS NRO
                ,{$prs_piso} AS PISO
                ,{$prs_depto} AS DEPTO
                ,{$cll_nombre_completo} AS NOMBRE_COMPLETO
                ,{$cll_nombre} AS NOMBRE_CALLE
                ,{$cnt_nro_pago} AS NRO_PAGO
                ,{$cnt_piso_pago} AS PISO_PAGO
                ,{$cnt_depto_pago} AS DEPTO_PAGO
                ,{#PARAM:/ROW/@CRR_TIPO} AS TIPO_CORREO
                ,{#PARAM:/ROW/@CRR_CODIGO} AS CORREO
                ,LPAD({$CantidadDeFacturas}, 5, '0') AS CANT_FACTURAS
                ,{$prs_c_postal} AS CODIGO_POSTAL
                ,{$prs_agf_nombre} AS LOCALIDAD
                ,{$cnt_c_postal_pago} AS CODIGO_POSTAL_PAGO
                ,{$cnt_agf_nombre} AS LOCALIDAD_PAGO
            FROM DUAL
        </qry:select>
        <qry:out>
            
            <qry:for-each-row>
                <qry:element name="ArchivoLote">
                    <qry:attribute name="tipo_de_resgistro" value="1"/>
                    <qry:attribute name="aviso_simple" value="A"/>
                    <qry:attribute name="numero_ordenativo" value="{#ROW:/ROW/@ORD_NUMERO}"/>
                    <qry:attribute name="sucursal" value="{#ROW:/ROW/@SCF_CODIGO}"/>
                    <qry:attribute name="numero_proceso" value="{#ROW:/ROW/@CPR_NUMERO}"/>
                    <qry:attribute name="importe_aviso" value="{#ROW:/ROW/@IMPORTE_AVISO}"/>
                    <qry:attribute name="anio" value="{#ROW:/ROW/@ANIO}"/>
                    <qry:attribute name="mes" value="{#ROW:/ROW/@MES}"/>
                    <qry:attribute name="dia" value="{#ROW:/ROW/@DIA}"/>
                    <qry:attribute name="razon_social" value="{#ROW:/ROW/@RAZON_SOCIAL}" length="25" align="left"/>
                    <qry:if left="{$prs_calle}" operator="not-equal" right="0" type="string">
                        <qry:attribute name="calle" value="{#ROW:/ROW/@CALLE}" length="18" align="left"/>
                        <qry:attribute name="nro_puerta" value="{#ROW:/ROW/@NRO}" length="4" align="left"/>
                        <qry:attribute name="piso" value="{#ROW:/ROW/@PISO}" length="2" align="left"/>
                        <qry:attribute name="codigo_postal" value="{#ROW:/ROW/@CODIGO_POSTAL}" length="7" align="left"/>
                        <qry:attribute name="localidad" value="{#ROW:/ROW/@LOCALIDAD}" length="30" align="left"/>
                    <qry:else/>
                        <qry:if left="{$cll_nombre}" operator="equal" right="0" type="string">
                            <qry:attribute name="nombre_completo" value="{#ROW:/ROW/@NOMBRE_COMPLETO}" length="27" align="left"/>
                        <qry:else/>
                            <qry:attribute name="calle_pago" value="{#ROW:/ROW/@NOMBRE_CALLE}" length="18" align="left"/>
                            <qry:attribute name="nro_puerta_pago" value="{#ROW:/ROW/@NRO_PAGO}" length="4" align="left"/>
                            <qry:attribute name="piso_pago" value="{#ROW:/ROW/@PISO_PAGO}" length="2" align="left"/>
                            <qry:attribute name="departamento_pago" value="{#ROW:/ROW/@DEPTO_PAGO}" length="3" align="left"/>
                        </qry:if>
                        <qry:attribute name="codigo_postal_pago" value="{#ROW:/ROW/@CODIGO_POSTAL_PAGO}" length="7" align="left"/>
                        <qry:attribute name="localidad_pago" value="{#ROW:/ROW/@LOCALIDAD_PAGO}" length="30" align="left"/>
                    </qry:if>
                    <qry:attribute name="tipo_correo" value="{#ROW:/ROW/@TIPO_CORREO}" length="2" align="left"/>
                    <qry:attribute name="codigo_correo" value="{#ROW:/ROW/@CORREO}" length="8" align="left"/>
                    <qry:attribute name="vacio" value=" " length="8" align="left"/>
                    <qry:attribute name="vacio" value=" " length="8" align="left"/>
                    <qry:attribute name="cantidad_facturas" value="{#ROW:/ROW/@CANT_FACTURAS}"/>
                    <qry:attribute name="titulo_aviso" value=" " length="30" align="left"/>
                    <qry:attribute name="codigo_zona" value=" " length="3" align="left"/>
                    <qry:attribute name="codigo_incidencia" value="00" length="2" align="left"/>
                </qry:element>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="GrabaEnReportes" > 
        <qry:select dump="0">
            SELECT to_char(sysdate, 'hhmiss') AS TIME
            FROM sys.dual
        </qry:select>
        <qry:out>
            <!-- Imprime algo -->
        </qry:out>
    </qry:query>

    <qry:query name="Notifi"> 
        <qry:select dump="0">
            SELECT NOT_CODIGO
            	,NOT_DESCRIPCION
            FROM TIPOS_NOTIFICACION
            WHERE NOT_CODIGO = {$not_codigo}
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="ban" value="0"/>
                <qry:set-variable name="v_tabla" value=" "/>
                
                    <qry:if left="{$not_codigo}" operator="equal" right="I7" type="string">
                        <!-- No deja usar los caracteres raros -->
                    <qry:else/>
                        <!-- No deja usar los caracteres raros -->
                    </qry:if>
                    <!-- Inicio iteracion cursor Texto -->
                    <qry:insert-query name="NotifiTexto" doc-param="#ROW:"/>
                    <!-- Fin iteracion cursor Texto -->
                    
                    <!-- No deja usar los caracteres raros -->
                    <qry:if left="{$not_codigo}" operator="equal" right="I1" type="string">
                        <qry:insert-query name="SelectCodigoBarras" doc-param="#ROW:"/>
                    <qry:else/>
                        <qry:if left="{$not_codigo}" operator="equal" right="I4" type="string">
                            <qry:insert-query name="SelectCodigoBarras" doc-param="#ROW:"/>
                        <qry:else/>
                            <qry:if left="{$not_codigo}" operator="equal" right="IP" type="string">
                                <qry:insert-query name="SelectCodigoBarras" doc-param="#ROW:"/>
                            </qry:if>
                        </qry:if>
                    </qry:if>
                
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="NotifiTexto">
        <qry:select dump="0">
            SELECT ENO.ENO_ORDEN
              ,ENO.ENO_TIPO
              ,ENO.ENO_TEXTO
              ,ENO.ENO_VAR_NOMBRE
              ,ENO.ENO_VAR_TIPO
              ,COALESCE(ENO.ENO_VAR_LONGITUD, 0) AS ENO_VAR_LONGITUD
              ,COALESCE(ENO.ENO_COL#, 0) AS ENO_COL#
              ,ENO.ENO_TIPO_CAMPO
            FROM ESTRUCTURA_NOTIFICACION ENO
            INNER JOIN SERVICIOS SRV
            	ON NVL(ENO.SCF_CODIGO, SRV.SCF_CODIGO) = SRV.SCF_CODIGO
            WHERE ENO.NOT_CODIGO = {#PARAM:/ROW/@NOT_CODIGO}
            	AND SRV.SRV_CODIGO = {$srv_cod}
            	AND ENO.ENO_ORDEN NOT IN 
            	(
            		SELECT DISTINCT NVL(ENO_SUB_ORDEN, 0)
            		FROM ESTRUCTURA_NOTIFICACION
            		WHERE NOT_CODIGO = {#PARAM:/ROW/@NOT_CODIGO}
            			AND SCF_CODIGO = SRV.SCF_CODIGO
            	)
            ORDER BY ENO.ENO_ORDEN
        </qry:select>
        <qry:out>
            <qry:set-variable name="TESTnotifi" value="0"/>
            <qry:element name="notificacion">
            <qry:for-each-row>
                <qry:set-variable name="TESTnotifi" value="1" operation="+"/>
                
                <qry:set-variable name="eno_col" value="{#ROW:/ROW/@ENO_COL#}"/>
                <qry:if left="{$v_tabla}" operator="not-equal" right="DOCUMENTOS" type="string">
                    <qry:set-variable name="largos" value="{#ROW:/ROW/@ENO_VAR_LONGITUD}"/> <!-- Largo del texto para la columna  -->
                </qry:if>
                    <qry:if left="#ROW:/ROW/@ENO_TIPO" operator="equal" right="T" type="string">
                        <qry:print output="stdout" value="Bucle-T-Notifi nro: {$TESTnotifi} Columna: {$v_tabla} / NotCodigo: {#PARAM:/ROW/@NOT_CODIGO} "/>
                        <qry:if left="{$ban}" operator="equal" right="1" type="integer">
                            <qry:if left="{$v_tabla}" operator="equal" right="DOCUMENTOS" type="string">
                                <!-- Tipo de tabla en memoria Documentos  -->
                                <qry:set-variable name="num_rows_doc" value="20"/>
                                <qry:set-variable name="nro_linea" value="0"/>
                                <qry:set-variable name="document_tbl_type" value="DOC"/>
                                <qry:if left="{$Tor_codigo}" operator="equal" right="D2" type="string">
                                    <qry:print output="stdout" value="      DocumentosD2 - trt_num: {$trt_num} / num_rows_doc : {$num_rows_doc} "/>
                                    <qry:insert-query name="DocumentosD2" doc-param="#ROW:"/>
                                <qry:else/>
                                    <qry:print output="stdout" value="      Documentos - nro_ord: {$nro_ord} / num_rows_doc : {$num_rows_doc} "/>
                                    <qry:insert-query name="Documentos" doc-param="#ROW:"/>
                                </qry:if>
                            <qry:else/>
                                <qry:if left="{$v_tabla}" operator="equal" right="DOCUMENTOS_GAR" type="string">
                                    <!-- Tipo de tabla en memoria Documentos  -->
                                    <qry:set-variable name="num_rows_doc" value="20"/>
                                    <qry:set-variable name="nro_linea" value="0"/>
                                    <qry:set-variable name="document_tbl_type" value="ORI"/>
                                    <qry:insert-query name="Ordenativos" doc-param="#ROW:"/>
                                    <qry:if left="{$Tor_codigo}" operator="equal" right="D2" type="string">
                                        <qry:print output="stdout" value="      DocumentosD2 - trt_num: {$trt_num} / num_rows_doc : {$num_rows_doc} "/>
                                        <qry:insert-query name="DocumentosD2" doc-param="#ROW:"/>
                                    <qry:else/>
                                        <qry:print output="stdout" value="      Documentos - nro_ord: {$nro_ord} / num_rows_doc : {$num_rows_doc} "/>
                                        <qry:insert-query name="Documentos" doc-param="#ROW:"/>
                                    </qry:if>

                                    <qry:print output="stdout" value="              TESToriAntes - srv_cod: {$srv_cod}"/>
                                    <qry:print output="stdout" value="              TESToriAntes - cnt_num: {$cnt_num}"/>
                                    <qry:print output="stdout" value="              TESToriAntes - trt_num: {$trt_num}"/>

                                    <qry:set-variable name="srv_cod" value="{$srv_cod_temp}"/>
                                    <qry:set-variable name="cnt_num" value="{$cnt_num_temp}"/>
                                    <qry:set-variable name="trt_num" value="{$trt_num_temp}"/>

                                    <qry:print output="stdout" value="              TESToriDespues - srv_cod: {$srv_cod}"/>
                                    <qry:print output="stdout" value="              TESToriDespues - cnt_num: {$cnt_num}"/>
                                    <qry:print output="stdout" value="              TESToriDespues - trt_num: {$trt_num}"/>
                                </qry:if>
                            </qry:if>
                            <qry:set-variable name="ban" value="0"/>
                        <qry:else/>
                            <qry:if left="#ROW:/ROW/@ENO_TEXTO" operator="not-equal" right="&#xA;" type="string">
                                <qry:if left="#ROW:/ROW/@ENO_TEXTO" operator="not-equal" right="/" type="string">
                                    <qry:element name="texto_notificacion">
                                        <qry:attribute name="eno_texto" value="#ROW:/ROW/@ENO_TEXTO"/>
                                    </qry:element>
                                </qry:if>
                            </qry:if>
                        </qry:if>
                    <qry:else/>
                        <qry:insert-query name="NotifiCargaTablas"/>
                        <qry:print output="stdout" value="Bucle - Notifi nro: {$TESTnotifi} Columna: {$v_tabla} / NotCodigo: {#PARAM:/ROW/@NOT_CODIGO} "/>
                        <qry:if left="#ROW:/ROW/@ENO_TIPO_CAMPO" operator="equal" right="F" type="string">
                            <!-- logica larga  -->
                                <qry:if left="{$ban}" operator="equal" right="1" type="integer">
                                    <qry:if left="{$v_tabla}" operator="equal" right="DOCUMENTOS" type="string">
                                        <!-- Tipo de tabla en memoria Documentos  -->
                                        <qry:set-variable name="num_rows_doc" value="20"/>
                                        <qry:set-variable name="nro_linea" value="0"/>
                                        <qry:set-variable name="document_tbl_type" value="DOC"/>
                                    
                                        <qry:if left="{$Tor_codigo}" operator="equal" right="D2" type="string">
                                            <qry:print output="stdout" value="      DocumentosD2 - trt_num: {$trt_num} / num_rows_doc : {$num_rows_doc} "/>
                                            <qry:insert-query name="DocumentosD2" doc-param="#ROW:"/>
                                        <qry:else/>
                                            <qry:print output="stdout" value="      Documentos - nro_ord: {$nro_ord} / num_rows_doc : {$num_rows_doc} "/>
                                            <qry:insert-query name="Documentos" doc-param="#ROW:"/>
                                        </qry:if>
                                    <qry:else/>
                                        <qry:if left="{$v_tabla}" operator="equal" right="DOCUMENTOS_GAR" type="string">
                                            <!-- Tipo de tabla en memoria Documentos  -->
                                            <qry:set-variable name="num_rows_doc" value="20"/>
                                            <qry:set-variable name="nro_linea" value="0"/>
                                            <qry:set-variable name="document_tbl_type" value="ORI"/>
                                        
                                            <qry:insert-query name="Ordenativos" doc-param="#ROW:"/>
                                            <qry:if left="{$Tor_codigo}" operator="equal" right="D2" type="string">
                                                <qry:print output="stdout" value="      DocumentosD2 - trt_num: {$trt_num} / num_rows_doc : {$num_rows_doc} "/>
                                                <qry:insert-query name="DocumentosD2" doc-param="#ROW:"/>
                                            <qry:else/>
                                                <qry:print output="stdout" value="      Documentos - nro_ord: {$nro_ord} / num_rows_doc : {$num_rows_doc} "/>
                                                <qry:insert-query name="Documentos" doc-param="#ROW:"/>
                                            </qry:if>
                                            <qry:set-variable name="srv_cod" value="{$srv_cod_temp}"/>
                                            <qry:set-variable name="cnt_num" value="{$cnt_num_temp}"/>
                                            <qry:set-variable name="trt_num" value="{$trt_num_temp}"/>
                                        </qry:if>
                                    </qry:if>
                                    <qry:set-variable name="ban" value="0"/>
                                </qry:if>

                                <qry:set-variable name="largos" value="{#ROW:/ROW/@ENO_VAR_LONGITUD}"/>

                                <qry:if left="{$v_tabla}" operator="equal" right="PERSONAS" type="string">
                                    <qry:print output="stdout" value="      Personas - prs_num: {$prs_num}"/>
                                    <qry:insert-query name="Personas" doc-param="#ROW:"/>
                                <qry:else/>
                                    <qry:if left="{$v_tabla}" operator="equal" right="PERSONAS_GAR" type="string">
                                        <qry:print output="stdout" value="      Ordenativos - nro_ord: {$nro_ord}"/>
                                        <qry:insert-query name="Ordenativos" doc-param="#ROW:"/>
                                        <qry:print output="stdout" value="      Prs_Num_Ori - cnt_num: {$cnt_num} / srv_cod: {$srv_cod}"/>
                                        <qry:insert-query name="Prs_Num_Ori" doc-param="#ROW:"/>
                                        <qry:set-variable name="srv_cod" value="{$srv_cod_temp}"/>
                                        <qry:set-variable name="cnt_num" value="{$cnt_num_temp}"/>
                                        <qry:set-variable name="trt_num" value="{$trt_num_temp}"/>
                                        <qry:print output="stdout" value="      Personas - prs_num: {$prs_num}"/>
                                        <qry:insert-query name="Personas" doc-param="#ROW:"/>
                                        <qry:set-variable name="prs_num" value="{$prs_num_temp}"/>
                                    <qry:else/>
                                        <qry:if left="{$v_tabla}" operator="equal" right="CONTRATOS" type="string">
                                            <qry:print output="stdout" value="      Contratos - srv_cod: {$srv_cod}"/>
                                            <qry:insert-query name="Contratos" doc-param="#ROW:"/>
                                        <qry:else/>
                                            <qry:if left="{$v_tabla}" operator="equal" right="CONTRATOS_GAR" type="string">
                                                <qry:print output="stdout" value="      Ordenativos - nro_ord: {$nro_ord}"/>
                                                <qry:insert-query name="Ordenativos" doc-param="#ROW:"/>
                                                <qry:print output="stdout" value="      Contratos - srv_cod: {$srv_cod}"/>
                                                <qry:insert-query name="Contratos" doc-param="#ROW:"/>
                                                <qry:set-variable name="srv_cod" value="{$srv_cod_temp}"/>
                                                <qry:set-variable name="cnt_num" value="{$cnt_num_temp}"/>
                                                <qry:set-variable name="trt_num" value="{$trt_num_temp}"/>
                                            <qry:else/>
                                                <qry:if left="{$v_tabla}" operator="equal" right="SERVICIOS" type="string">
                                                    <qry:print output="stdout" value="      Servicios - srv_cod: {$srv_cod}"/>
                                                    <qry:insert-query name="Servicios" doc-param="#ROW:"/>
                                                <qry:else/>
                                                    <qry:if left="{$v_tabla}" operator="equal" right="SERVICIOS_GAR" type="string">
                                                        <qry:print output="stdout" value="      Ordenativos - nro_ord: {$nro_ord}"/>
                                                        <qry:insert-query name="Ordenativos" doc-param="#ROW:"/>
                                                        <qry:print output="stdout" value="      Servicios - srv_cod: {$srv_cod}"/>
                                                        <qry:insert-query name="Servicios" doc-param="#ROW:"/>
                                                        <qry:set-variable name="srv_cod" value="{$srv_cod_temp}"/>
                                                        <qry:set-variable name="cnt_num" value="{$cnt_num_temp}"/>
                                                        <qry:set-variable name="trt_num" value="{$trt_num_temp}"/>
                                                    <qry:else/>
                                                        <qry:if left="{$v_tabla}" operator="equal" right="LECTURAS" type="string">
                                                            <qry:print output="stdout" value="      Lecturas - srv_cod: {$srv_cod}"/>
                                                            <qry:insert-query name="Lecturas" doc-param="#ROW:"/>
                                                        <qry:else/>
                                                            <qry:if left="{$v_tabla}" operator="equal" right="ORDENATIVOS" type="string">
                                                                <qry:print output="stdout" value="      Ordenativos - nro_ord: {$nro_ord}"/>
                                                                <qry:insert-query name="Ordenativos" doc-param="#ROW:"/>
                                                                <qry:set-variable name="srv_cod" value="{$srv_cod_temp}"/>
                                                                <qry:set-variable name="cnt_num" value="{$cnt_num_temp}"/>
                                                                <qry:set-variable name="trt_num" value="{$trt_num_temp}"/>
                                                            <qry:else/>
                                                                <qry:if left="{$v_tabla}" operator="equal" right="TIPOS_ORDENATIVO" type="string">
                                                                    <qry:insert-query name="TiposOrdenativo" doc-param="#ROW:"/>
                                                                <qry:else/>
                                                                    <qry:if left="{$v_tabla}" operator="equal" right="POTENCIAS" type="string">
                                                                        <qry:print output="stdout" value="      Potencias - srv_cod / cnt_num: {$srv_cod} / {$cnt_num}"/>
                                                                        <qry:insert-query name="Potencias" doc-param="#ROW:"/>
                                                                    <qry:else/>
                                                                        <qry:if left="{$v_tabla}" operator="equal" right="STOCK_EQUIPOS" type="string">
                                                                            <qry:print output="stdout" value="      Stock_Equipos - srv_cod: {$srv_cod}"/>
                                                                            <qry:insert-query name="Stock_Equipos" doc-param="#ROW:"/>
                                                                        <qry:else/>
                                                                            <qry:if left="{$v_tabla}" operator="equal" right="SUCURSALES" type="string">
                                                                                <qry:print output="stdout" value="      Sucursales - scf_cod: {$scf_cod}"/>
                                                                                <qry:insert-query name="Sucursales" doc-param="#ROW:"/>
                                                                            <qry:else/>
                                                                                <qry:if left="{$v_tabla}" operator="equal" right="CARGOS" type="string">
                                                                                    <qry:print output="stdout" value="      Cargos - ord_fec: {$ord_fec}"/>
                                                                                    <qry:insert-query name="Cargos" doc-param="#ROW:"/>
                                                                                <qry:else/>
                                                                                    <qry:if left="{$v_tabla}" operator="equal" right="BANCOS" type="string">
                                                                                        <qry:print output="stdout" value="      Bancos - agf_cod: {$agf_cod}"/>
                                                                                        <qry:insert-query name="Bancos" doc-param="#ROW:"/>
                                                                                    <qry:else/>
                                                                                        <qry:if left="{$v_tabla}" operator="equal" right="TIPOS_IVA" type="string">
                                                                                            <qry:print output="stdout" value="      Tipos IVA - ivv_cod: {$ivv_cod}"/>
                                                                                            <qry:insert-query name="Tipos_IVA" doc-param="#ROW:"/>
                                                                                        <qry:else/>
                                                                                            <qry:if left="{$v_tabla}" operator="equal" right="TIPOS_NOTIFICACION" type="string">
                                                                                                <qry:print output="stdout" value="      Tipos Notificacion - tipo_notificacion: {#PARAM:/ROW/@NOT_DESCRIPCION}"/>
                                                                                                <qry:attribute name="tipo_notificacion" value="{#PARAM:/ROW/@NOT_DESCRIPCION}"/>
                                                                                            <qry:else/>
                                                                                                <qry:if left="{$v_tabla}" operator="equal" right="TARIFAS" type="string">
                                                                                                    <qry:print output="stdout" value="      Tarifas - tcl_cod: {$tcl_cod}"/>
                                                                                                    <qry:insert-query name="Tarifas" doc-param="#ROW:"/>
                                                                                                <qry:else/>
                                                                                                    <qry:if left="{$v_tabla}" operator="equal" right="TOTALES_TRAMITE" type="string">
                                                                                                        <qry:print output="stdout" value="      Totales Tramites - trt_num: {$trt_num}"/>
                                                                                                        <qry:insert-query name="Totales_Tramite" doc-param="#ROW:"/>
                                                                                                    <qry:else/>
                                                                                                        <qry:if left="{$v_tabla}" operator="equal" right="TOTALES_TRAMITE_GAR" type="string">
                                                                                                            <qry:print output="stdout" value="      Ordenativos - nro_ord: {$nro_ord}"/>
                                                                                                            <qry:insert-query name="Ordenativos" doc-param="#ROW:"/>
                                                                                                            <qry:print output="stdout" value="      Totales Tramites - trt_num: {$trt_num}"/>
                                                                                                            <qry:insert-query name="Totales_Tramite" doc-param="#ROW:"/>
                                                                                                            <qry:set-variable name="srv_cod" value="{$srv_cod_temp}"/>
                                                                                                            <qry:set-variable name="cnt_num" value="{$cnt_num_temp}"/>
                                                                                                            <qry:set-variable name="trt_num" value="{$trt_num_temp}"/>
                                                                                                        <qry:else/>
                                                                                                            <qry:if left="{$v_tabla}" operator="equal" right="USUARIOS" type="string">
                                                                                                                <qry:print output="stdout" value="      Usuarios"/>
                                                                                                                <qry:insert-query name="Usuarios" doc-param="#ROW:"/>
                                                                                                            </qry:if>
                                                                                                        </qry:if>
                                                                                                    </qry:if>
                                                                                                </qry:if>
                                                                                            </qry:if>
                                                                                        </qry:if>
                                                                                    </qry:if>
                                                                                </qry:if>
                                                                            </qry:if>
                                                                        </qry:if>
                                                                    </qry:if>
                                                                </qry:if>
                                                            </qry:if>
                                                        </qry:if>
                                                    </qry:if>
                                                </qry:if>
                                            </qry:if>
                                        </qry:if>
                                    </qry:if>
                                </qry:if>
                            <!-- logica larga  -->
                        <qry:else/>
                            <qry:if left="{$ban}" operator="equal" right="0" type="integer">
                                <qry:set-variable name="ban" value="1"/>
                            </qry:if>
                            <qry:if left="{$v_tabla}" operator="equal" right="DOCUMENTOS" type="string">
                                <qry:set-variable name="largos" value="{#ROW:/ROW/@ENO_VAR_LONGITUD}"/>
                            <qry:else/>
                                <qry:if left="{$v_tabla}" operator="equal" right="DOCUMENTOS_GAR" type="string">
                                    <qry:set-variable name="largos" value="{#ROW:/ROW/@ENO_VAR_LONGITUD}"/>
                                </qry:if>
                            </qry:if>
                        </qry:if>
                        <qry:if left="{$v_tabla}" operator="equal" right="BANCOS" type="string">
                            <qry:if left="{$Tiene_Comprobantes_Financiaciones}" operator="not-equal" right="0" type="integer">
                                <qry:if left="{$Tiene_Otros_Comprobantes}" operator="not-equal" right="0" type="integer">
                                    <qry:attribute name="mensg_comprobante" value="Cuotas vencidas financ. instalaciones internas unicamen-te podran abonarse en Of.Comerciales Litoral Gas."/>
                                </qry:if>
                            </qry:if>
                        </qry:if>
                    </qry:if>
            </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="NotifiCargaTablas" > 
        <qry:select>
            SELECT TABLA
            	  ,COLUMNA
            FROM COL_NOTIFICACION
            WHERE COL# = {$eno_col}
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="v_tabla" value="#ROW:/ROW/@TABLA"/>
                <qry:set-variable name="v_columna" value="#ROW:/ROW/@COLUMNA"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Personas"> 
        <qry:out>
            <qry:if left="{$isEmpty_personas}" operator="equal" right="0" type="integer">
                <qry:insert-query name="QueryPersonas"/>
            <qry:else/>
                <qry:if left="{$actual_prs_numero}" operator="not-equal" right="{$prs_num}" type="integer">
                    <qry:insert-query name="QueryPersonas"/>
                </qry:if>
            </qry:if>

            <qry:for-each-row  doc="$TBL_personas:">
                <qry:set-variable name="s_srv_agf_nombre" value="0"/>
                <qry:element name="persona">
                    <qry:if left="{$v_columna}" operator="equal" right="PRS_NUMERO" type="string">
                        <qry:if left="#ROW:/ROW/@PRS_NUMERO" operator="greater" right="0" type="string">
                            <qry:attribute name="numero" value="#ROW:/ROW/@PRS_NUMERO" length="$largos" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                        </qry:if>
                    <qry:else/>
                        <qry:if left="{$v_columna}" operator="equal" right="PRS_RAZON_SOCIAL" type="string">
                            <qry:attribute name="razon_social" value="#ROW:/ROW/@PRS_RAZON_SOCIAL" length="$largos" align="left"/>
                        <qry:else/>
                            <qry:if left="{$v_columna}" operator="equal" right="PRS_CUIT" type="string">
                                <qry:if left="#ROW:/ROW/@PRS_CUIT" operator="greater" right="0" type="string">
                                    <qry:attribute name="cuit" value="#ROW:/ROW/@PRS_CUIT" length="$largos" align="left"/>
                                <qry:else/>
                                    <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                </qry:if>
                            <qry:else/>
                                <qry:if left="{$v_columna}" operator="equal" right="PRS_TIPO_DOC" type="string">
                                    <qry:attribute name="tipo_doc" value="#ROW:/ROW/@PRS_TIPO_DOC" length="$largos" align="left"/>
                                <qry:else/>
                                    <qry:if left="{$v_columna}" operator="equal" right="PRS_DOCUMENTO" type="string">
                                        <qry:if left="#ROW:/ROW/@PRS_DOCUMENTO" operator="greater" right="0" type="integer">
                                            <qry:attribute name="documento" value="#ROW:/ROW/@PRS_DOCUMENTO" length="$largos" align="left"/>
                                        <qry:else/>
                                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                        </qry:if>
                                    <qry:else/>
                                        <qry:if left="{$v_columna}" operator="equal" right="PRS_NRO" type="string">
                                            <qry:attribute name="nro" value="#ROW:/ROW/@PRS_NRO" length="$largos" align="left"/>
                                        <qry:else/>
                                            <qry:if left="{$v_columna}" operator="equal" right="PRS_DEPTO" type="string">
                                                <qry:attribute name="depto" value="#ROW:/ROW/@PRS_DEPTO" length="$largos" align="left"/>
                                            <qry:else/>
                                                <qry:if left="{$v_columna}" operator="equal" right="AGF_CODIGO" type="string">
                                                    <qry:if left="#ROW:/ROW/@AGF_CODIGO" operator="greater" right="0" type="integer">
                                                        <qry:attribute name="codigo_area_geografica" value="#ROW:/ROW/@AGF_CODIGO" length="$largos" align="left"/>
                                                    <qry:else/>
                                                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                    </qry:if>
                                                <qry:else/>
                                                    <qry:if left="{$v_columna}" operator="equal" right="CLL_NOMBRE" type="string">
                                                        <qry:attribute name="direccion" value="#ROW:/ROW/@PRS_DIRECCION" length="$largos" align="left"/>
                                                    <qry:else/>
                                                        <qry:if left="{$v_columna}" operator="equal" right="PRS_C_POSTAL" type="string">
                                                            <qry:if left="#ROW:/ROW/@PRS_C_POSTAL" operator="not-equal" right="0" type="string">
                                                                <qry:attribute name="cod_postal" value="#ROW:/ROW/@PRS_C_POSTAL" length="$largos" align="left"/>
                                                            <qry:else/>
                                                                <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                            </qry:if>
                                                        <qry:else/>
                                                            <qry:if left="{$v_columna}" operator="equal" right="PRS_TELEFONOS" type="string">
                                                                <qry:attribute name="telefonos" value="#ROW:/ROW/@PRS_TELEFONOS" length="$largos" align="left"/>
                                                            <qry:else/>
                                                                <qry:if left="{$v_columna}" operator="equal" right="PRS_FAX" type="string">
                                                                    <qry:attribute name="fax" value="#ROW:/ROW/@PRS_FAX" length="$largos" align="left"/>
                                                                <qry:else/>
                                                                    <qry:if left="{$v_columna}" operator="equal" right="PRS_ESTADO" type="string">
                                                                        <qry:attribute name="estado" value="#ROW:/ROW/@PRS_ESTADO" length="$largos" align="left"/>
                                                                    <qry:else/>
                                                                        <qry:if left="{$v_columna}" operator="equal" right="PRS_PISO" type="string">
                                                                            <qry:attribute name="piso" value="#ROW:/ROW/@PRS_PISO" length="$largos" align="left"/>
                                                                        <qry:else/>
                                                                            <qry:if left="{$v_columna}" operator="equal" right="PRS_LOCALIDAD" type="string">
                                                                                <qry:insert-query name="BuscaAreaGeografica" doc-param="#ROW:"/>
                                                                                <qry:if left="{$s_srv_agf_nombre}" operator="not-equal" right="0" type="string"> 
                                                                                    <qry:attribute name="area_geografica" value="$s_srv_agf_nombre"/>
                                                                                </qry:if>
                                                                            <qry:else/>
                                                                                <qry:if left="{$v_columna}" operator="equal" right="PRS_DIRECCION" type="string">
                                                                                    <qry:element name="srv_direccion">
                                                                                        <qry:attribute name="direccion" value="#ROW:/ROW/@PRS_DIRECCION"/>
                                                                                        <!-- logica complicada direccion -->
                                                                                            <qry:if left="#ROW:/ROW/@PRS_BIS" operator="not-equal" right="0" type="string">
                                                                                                <qry:if left="#ROW:/ROW/@PRS_BIS" operator="not-equal" right="N" type="string">
                                                                                                    <qry:attribute name="bis" value="#ROW:/ROW/@PRS_BIS"/>
                                                                                                </qry:if>
                                                                                            </qry:if>
                                                                                            <qry:if left="#ROW:/ROW/@PRS_NRO" operator="not-equal" right="0" type="string">
                                                                                                <qry:attribute name="nro" value="#ROW:/ROW/@PRS_NRO"/>
                                                                                            </qry:if>
                                                                                            <qry:if left="#ROW:/ROW/@PRS_TORRE" operator="not-equal" right="0" type="string">
                                                                                                <qry:attribute name="torre" value="#ROW:/ROW/@PRS_TORRE"/>
                                                                                            </qry:if>
                                                                                            <qry:if left="#ROW:/ROW/@PRS_PISO" operator="not-equal" right="0" type="string">
                                                                                                <qry:attribute name="piso" value="#ROW:/ROW/@PRS_PISO"/>
                                                                                            </qry:if>
                                                                                            <qry:if left="#ROW:/ROW/@PRS_DEPTO" operator="not-equal" right="0" type="string">
                                                                                                <qry:attribute name="depto" value="#ROW:/ROW/@PRS_DEPTO"/>
                                                                                            </qry:if>
                                                                                            <qry:if left="#ROW:/ROW/@PRS_C_POSTAL" operator="not-equal" right="0" type="string">
                                                                                                <qry:attribute name="cod_postal" value="#ROW:/ROW/@PRS_C_POSTAL"/>
                                                                                                <qry:insert-query name="BuscaAreaGeografica" doc-param="#ROW:"/>
                                                                                                <qry:if left="{$s_srv_agf_nombre}" operator="not-equal" right="0" type="string"> 
                                                                                                    <qry:attribute name="area_geografica" value="$s_srv_agf_nombre"/>
                                                                                                </qry:if>
                                                                                            </qry:if>
                                                                                        <!-- logica complicada direccion -->
                                                                                    </qry:element>
                                                                                <qry:else/>
                                                                                    <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                                </qry:if>
                                                                            </qry:if>
                                                                        </qry:if>
                                                                    </qry:if>
                                                                </qry:if>
                                                            </qry:if>
                                                        </qry:if>
                                                    </qry:if>
                                                </qry:if>
                                            </qry:if>
                                        </qry:if>
                                    </qry:if>|
                                </qry:if>
                            </qry:if>
                        </qry:if>
                    </qry:if>
                </qry:element>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="QueryPersonas" > 
        <qry:select dump="0">
            SELECT TO_CHAR(P.PRS_NUMERO) AS PRS_NUMERO
              ,P.PRS_RAZON_SOCIAL 
              ,TO_CHAR(COALESCE(NVL(P.PRS_CUIT, 0), 0)) AS PRS_CUIT
              ,COALESCE(NVL(P.PRS_TIPO_DOC, ''), '0') AS PRS_TIPO_DOC
              ,COALESCE(NVL(P.PRS_DOCUMENTO, 0), 0) AS PRS_DOCUMENTO
              ,COALESCE(NVL(P.PRS_NRO, 0), '0') AS PRS_NRO
              ,COALESCE(NVL(P.PRS_DEPTO, ''), '0') AS PRS_DEPTO
              ,NVL(P.AGF_CODIGO, 0) AS AGF_CODIGO
              ,COALESCE(NVL(P.PRS_C_POSTAL, ''), '0') AS PRS_C_POSTAL
              ,COALESCE(NVL(P.PRS_TELEFONOS, 0), '0') AS PRS_TELEFONOS
              ,COALESCE(NVL(P.PRS_FAX, 0), '0') AS PRS_FAX
              ,COALESCE(NVL(P.PRS_ESTADO, ''), '0') AS PRS_ESTADO
              ,COALESCE(NVL(P.PRS_PISO, 0), '0') AS PRS_PISO
              ,TRIM(COALESCE(NVL(C.CLL_NOMBRE, ''), '0')) AS PRS_DIRECCION
              ,COALESCE(NVL(DECODE(P.PRS_BIS, 'N', ' ', P.PRS_BIS), ' '), '0') AS PRS_BIS
              ,COALESCE(NVL(P.PRS_TORRE, ' '), '0') AS PRS_TORRE
            FROM PERSONAS P
            INNER JOIN CALLES C
              ON (C.AGF_CODIGO = P.AGF_CODIGO AND C.CLL_CODIGO = P.CLL_CODIGO)
            WHERE P.PRS_NUMERO = {$prs_num}
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_prs_numero" value="{$prs_num}"/>
            <qry:set-variable name="TBL_personas" value="#ROW:"/>
            <qry:set-variable name="isEmpty_personas" value="1"/>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Contratos"> 
        <qry:out>
            <qry:if left="{$isEmpty_contratos}" operator="equal" right="0" type="integer">
                <qry:insert-query name="QueryContratos"/>
            <qry:else/>
                <qry:if left="{$actual_srv_cod}" operator="not-equal" right="{$srv_cod}" type="integer">
                    <qry:insert-query name="QueryContratos"/>
                </qry:if>
            </qry:if>

            <qry:if left="{$isEmpty_contratos}" operator="equal" right="0" type="integer">
                <qry:insert-query name="QueryContratos"/>
            </qry:if>

            <qry:for-each-row  doc="$TBL_contratos:">
                <qry:set-variable name="ivv_codigo" value="#ROW:/ROW/@IVV_CODIGO"/>
                <qry:set-variable name="tcl_cod" value="#ROW:/ROW/@TCL_CODIGO"/>
                <qry:element name="contrato">
                    <qry:if left="{$v_columna}" operator="equal" right="SRV_CODIGO" type="string"> 
                        <qry:if left="{$srv_cod}" operator="greater" right="0" type="integer">
                            <qry:attribute name="srv_cod" value="$srv_cod" length="$largos" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                        </qry:if>
                    <qry:else/>
                        <qry:if left="{$v_columna}" operator="equal" right="CNT_NUMERO" type="string"> 
                            <qry:if left="{$cnt_num}" operator="greater" right="0" type="integer">
                                <qry:attribute name="num" value="$cnt_num" length="$largos" align="left"/>
                            <qry:else/>
                                <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                            </qry:if>
                        <qry:else/>
                            <qry:if left="{$v_columna}" operator="equal" right="PRS_NUMERO" type="string"> 
                                <qry:if left="#ROW:/ROW/@PRS_NUMERO" operator="greater" right="0" type="integer">
                                    <qry:attribute name="prs_numero" value="#ROW:/ROW/@PRS_NUMERO" length="$largos" align="left"/>
                                <qry:else/>
                                    <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                </qry:if>
                            <qry:else/>
                                <qry:if left="{$v_columna}" operator="equal" right="PRS_NUMERO_APODERADO" type="string"> 
                                    <qry:if left="#ROW:/ROW/@PRS_NUMERO_APODERADO" operator="greater" right="0" type="integer">
                                        <qry:attribute name="prs_numero_apoderado" value="#ROW:/ROW/@PRS_NUMERO_APODERADO" length="$largos" align="left"/>
                                    <qry:else/>
                                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                    </qry:if>
                                <qry:else/>
                                    <qry:if left="{$v_columna}" operator="equal" right="TCL_CODIGO" type="string"> 
                                        <qry:attribute name="tcl_codigo" value="#ROW:/ROW/@TCL_CODIGO" length="$largos" align="left"/>
                                    <qry:else/>
                                        <qry:if left="{$v_columna}" operator="equal" right="CLA_CODIGO" type="string"> 
                                            <qry:attribute name="cla_codigo" value="#ROW:/ROW/@CLA_CODIGO" length="$largos" align="left"/>
                                        <qry:else/>
                                            <qry:if left="{$v_columna}" operator="equal" right="TEN_CODIGO" type="string"> 
                                                <qry:attribute name="ten_codigo" value="#ROW:/ROW/@TEN_CODIGO" length="$largos" align="left"/>
                                            <qry:else/>
                                                <qry:if left="{$v_columna}" operator="equal" right="CAT_CODIGO" type="string"> 
                                                    <qry:attribute name="cat_codigo" value="#ROW:/ROW/@CAT_CODIGO" length="$largos" align="left"/>
                                                <qry:else/>
                                                    <qry:if left="{$v_columna}" operator="equal" right="OBT_PROPIETARIO" type="string"> 
                                                        <qry:attribute name="propietario" value="#ROW:/ROW/@OBT_PROPIETARIO" length="$largos" align="left"/>
                                                    <qry:else/>
                                                        <qry:if left="{$v_columna}" operator="equal" right="CNT_FECHA_INICIO" type="string">
                                                            <qry:attribute name="cnt_fecha_inicio" value="#ROW:/ROW/@CNT_FECHA_INICIO" length="$largos" align="left"/>
                                                        <qry:else/>
                                                            <qry:if left="{$v_columna}" operator="equal" right="IVV_CODIGO" type="string"> 
                                                                <qry:if left="#ROW:/ROW/@IVV_CODIGO" operator="greater" right="0" type="integer">
                                                                    <qry:attribute name="ivv_codigo" value="#ROW:/ROW/@IVV_CODIGO" length="$largos" align="left"/>
                                                                <qry:else/>
                                                                    <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                </qry:if>
                                                            <qry:else/>
                                                                <qry:if left="{$v_columna}" operator="equal" right="CNT_FECHA_FIN" type="string">
                                                                    <qry:attribute name="fecha_fin" value="#ROW:/ROW/@CNT_FECHA_FIN" length="$largos" align="left"/>
                                                                <qry:else/>
                                                                    <qry:if left="{$v_columna}" operator="equal" right="CNT_TIPO" type="string">
                                                                        <qry:attribute name="tipo" value="#ROW:/ROW/@CNT_TIPO" length="$largos" align="left"/>
                                                                    <qry:else/>
                                                                        <qry:if left="{$v_columna}" operator="equal" right="CNT_DIRECCION_PAGO" type="string"> 
                                                                            <!-- logica complicada  -->
                                                                            <qry:element name="srv_direccion">
                                                                                <qry:if left="{$srv_cod}" operator="equal" right="0" type="integer">
                                                                                    <qry:insert-query name="BuscarDomicilioPostal" doc-param="#ROW:"/>
                                                                                <qry:else/>
                                                                                    <qry:if left="#ROW:/ROW/@CNT_DIRECCION_PAGO" operator="not-equal" right="0" type="string">
                                                                                        <qry:attribute name="direccion_pago" value="#ROW:/ROW/@CNT_DIRECCION_PAGO"/>
                                                                                    <qry:else/>
                                                                                        <qry:attribute name="calle" value="#ROW:/ROW/@CLL_NOMBRE"/>
                                                                                        
                                                                                        <qry:if left="#ROW:/ROW/@CNT_BIS" operator="not-equal" right="0" type="string">
                                                                                            <qry:if left="#ROW:/ROW/@CNT_BIS" operator="not-equal" right="N" type="string">
                                                                                                <qry:attribute name="bis" value="#ROW:/ROW/@CNT_BIS"/>
                                                                                            </qry:if>
                                                                                        </qry:if>
                                                                                        <qry:if left="#ROW:/ROW/@CNT_NRO_PAGO" operator="not-equal" right="0" type="string">
                                                                                            <qry:attribute name="nro_pago" value="#ROW:/ROW/@CNT_NRO_PAGO"/>
                                                                                        </qry:if>
                                                                                        <qry:if left="#ROW:/ROW/@CNT_TORRE_PAGO" operator="not-equal" right="0" type="string">
                                                                                            <qry:attribute name="torre_pago" value="#ROW:/ROW/@CNT_TORRE_PAGO"/>
                                                                                        </qry:if>
                                                                                        <qry:if left="#ROW:/ROW/@CNT_PISO_PAGO" operator="not-equal" right="0" type="string">
                                                                                            <qry:attribute name="piso_pago" value="#ROW:/ROW/@CNT_PISO_PAGO"/>
                                                                                        </qry:if>
                                                                                        <qry:if left="#ROW:/ROW/@CNT_DEPTO_PAGO" operator="not-equal" right="0" type="string">
                                                                                            <qry:attribute name="depto_pago" value="#ROW:/ROW/@CNT_DEPTO_PAGO"/>
                                                                                        </qry:if>
                                                                                        <qry:if left="#ROW:/ROW/@CNT_C_POSTAL_PAGO" operator="not-equal" right="0" type="string">
                                                                                            <qry:attribute name="cod_postal_pago" value="#ROW:/ROW/@CNT_C_POSTAL_PAGO"/>
                                                                                            <qry:set-variable name="s_srv_agf_nombre" value="0"/>
                                                                                            <qry:insert-query name="BuscaAreaGeografica" doc-param="#ROW:"/>
                                                                                            <qry:if left="{$s_srv_agf_nombre}" operator="not-equal" right="0" type="string"> 
                                                                                                <qry:attribute name="area_geografica" value="$s_srv_agf_nombre"/>
                                                                                            </qry:if>
                                                                                        </qry:if>

                                                                                    </qry:if>
                                                                                </qry:if>
                                                                            </qry:element>
                                                                            <!-- logica complicada  -->
                                                                        <qry:else/>
                                                                            <qry:if left="{$v_columna}" operator="equal" right="CNT_NRO_PAGO" type="string">
                                                                                <qry:attribute name="nro_pago" value="#ROW:/ROW/@CNT_NRO_PAGO" length="$largos" align="left"/>
                                                                            <qry:else/>
                                                                                <qry:if left="{$v_columna}" operator="equal" right="CNT_PISO_PAGO" type="string">
                                                                                    <qry:attribute name="piso_pago" value="#ROW:/ROW/@CNT_PISO_PAGO" length="$largos" align="left"/>
                                                                                <qry:else/>
                                                                                    <qry:if left="{$v_columna}" operator="equal" right="CNT_DEPTO_PAGO" type="string">
                                                                                        <qry:attribute name="depto_pago" value="#ROW:/ROW/@CNT_DEPTO_PAGO" length="$largos" align="left"/>
                                                                                    <qry:else/>
                                                                                        <qry:if left="{$v_columna}" operator="equal" right="CNT_C_POSTAL_PAGO" type="string">
                                                                                            <qry:if left="#ROW:/ROW/@CNT_C_POSTAL_PAGO" operator="not-equal" right="0" type="integer">
                                                                                                <qry:attribute name="cod_postal_pago" value="#ROW:/ROW/@CNT_C_POSTAL_PAGO" length="$largos" align="left"/>
                                                                                            <qry:else/>
                                                                                                <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                                            </qry:if>
                                                                                        <qry:else/>
                                                                                            <qry:if left="{$v_columna}" operator="equal" right="MIN_CODIGO" type="string">
                                                                                                <qry:attribute name="min_codigo" value="#ROW:/ROW/@MIN_CODIGO" length="$largos" align="left"/>
                                                                                            <qry:else/>
                                                                                                <qry:if left="{$v_columna}" operator="equal" right="CNT_ANIO" type="string">
                                                                                                    <qry:if left="#ROW:/ROW/@CNT_ANIO" operator="not-equal" right="0" type="integer">
                                                                                                        <qry:attribute name="anio" value="#ROW:/ROW/@CNT_ANIO" length="$largos" align="left"/>
                                                                                                    <qry:else/>
                                                                                                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                                                    </qry:if>
                                                                                                <qry:else/>
                                                                                                    <qry:if left="{$v_columna}" operator="equal" right="CNT_PERIODO" type="string">
                                                                                                        <qry:if left="#ROW:/ROW/@CNT_PERIODO" operator="not-equal" right="0" type="integer">
                                                                                                            <qry:attribute name="periodo" value="#ROW:/ROW/@CNT_PERIODO" length="$largos" align="left"/>
                                                                                                        <qry:else/>
                                                                                                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                                                        </qry:if>
                                                                                                    <qry:else/>
                                                                                                        <qry:if left="{$v_columna}" operator="equal" right="CNT_LEGAJO" type="string">
                                                                                                            <qry:attribute name="legajo" value="#ROW:/ROW/@CNT_LEGAJO" length="$largos" align="left"/>
                                                                                                        <qry:else/>
                                                                                                            <qry:if left="{$v_columna}" operator="equal" right="CNT_CIIU" type="string">
                                                                                                                <qry:if left="#ROW:/ROW/@CNT_CIIU" operator="not-equal" right="0" type="integer">
                                                                                                                    <qry:attribute name="ciiu" value="#ROW:/ROW/@CNT_CIIU" length="$largos" align="left"/>
                                                                                                                <qry:else/>
                                                                                                                    <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                                                                </qry:if>
                                                                                                            <qry:else/>
                                                                                                                <qry:if left="{$v_columna}" operator="equal" right="URC_CODIGO" type="string">
                                                                                                                    <qry:if left="#ROW:/ROW/@URC_CODIGO" operator="not-equal" right="0" type="integer">
                                                                                                                        <qry:attribute name="urc_codigo" value="#ROW:/ROW/@URC_CODIGO" length="$largos" align="left"/>
                                                                                                                    <qry:else/>
                                                                                                                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                                                                    </qry:if>
                                                                                                                <qry:else/>
                                                                                                                    <qry:if left="{$v_columna}" operator="equal" right="MPA_TIPO_MEDIO_PAGO" type="string">
                                                                                                                        <qry:attribute name="mpa_tipo_medio_pago" value="#ROW:/ROW/@MPA_TIPO_MEDIO_PAGO" length="$largos" align="left"/>
                                                                                                                    <qry:else/>
                                                                                                                        <qry:if left="{$v_columna}" operator="equal" right="CNT_NUMERO_CUENTA" type="string">
                                                                                                                            <qry:attribute name="numero_cuenta" value="#ROW:/ROW/@CNT_NUMERO_CUENTA" length="$largos" align="left"/>
                                                                                                                        <qry:else/>
                                                                                                                            <qry:if left="{$v_columna}" operator="equal" right="CNT_OBSERVACIONES" type="string">
                                                                                                                                <qry:attribute name="observaciones" value="#ROW:/ROW/@CNT_OBSERVACIONES" length="$largos" align="left"/>
                                                                                                                            <qry:else/>
                                                                                                                                <qry:if left="{$v_columna}" operator="equal" right="OIM_TIPO" type="string">
                                                                                                                                    <qry:attribute name="oim_tipo" value="#ROW:/ROW/@OIM_TIPO" length="$largos" align="left"/>
                                                                                                                                <qry:else/>
                                                                                                                                    <qry:if left="{$v_columna}" operator="equal" right="CNT_ESTADO" type="string">
                                                                                                                                        <qry:attribute name="estado" value="#ROW:/ROW/@CNT_ESTADO" length="$largos" align="left"/>
                                                                                                                                    <qry:else/>
                                                                                                                                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                                                                                    </qry:if>
                                                                                                                                </qry:if>
                                                                                                                            </qry:if>
                                                                                                                        </qry:if>
                                                                                                                    </qry:if>
                                                                                                                </qry:if>
                                                                                                            </qry:if>
                                                                                                        </qry:if>
                                                                                                    </qry:if>
                                                                                                </qry:if>
                                                                                            </qry:if>
                                                                                        </qry:if>
                                                                                    </qry:if>
                                                                                </qry:if>
                                                                            </qry:if>
                                                                        </qry:if>
                                                                    </qry:if>
                                                                </qry:if>
                                                            </qry:if>
                                                        </qry:if>
                                                    </qry:if>
                                                </qry:if>
                                            </qry:if>
                                        </qry:if>
                                    </qry:if>
                                </qry:if>
                            </qry:if>
                        </qry:if>
                    </qry:if>
                </qry:element>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="QueryContratos" > 
        <qry:select dump="0">
            SELECT T.PRS_NUMERO
            	,COALESCE(T.PRS_NUMERO_APODERADO, 0) AS PRS_NUMERO_APODERADO
            	,T.TCL_CODIGO
            	,T.CLA_CODIGO
            	,T.TEN_CODIGO
            	,T.CAT_CODIGO
            	,COALESCE(T.CNT_PROPIETARIO, '0') AS OBT_PROPIETARIO
            	,to_char(T.CNT_FECHA_INICIO, 'dd/mm/yy') AS CNT_FECHA_INICIO
            	,T.IVV_CODIGO
            	,COALESCE(to_char(T.CNT_FECHA_FIN, 'dd/mm/yy'), '0') AS CNT_FECHA_FIN
            	,T.CNT_TIPO
            	,COALESCE(regexp_replace(T.CNT_DIRECCION_PAGO, '[[:space:]]+', chr(32)), '0') AS CNT_DIRECCION_PAGO
            	,COALESCE(T.CNT_NRO_PAGO, '0') AS CNT_NRO_PAGO
            	,COALESCE(T.CNT_PISO_PAGO, '0') AS CNT_PISO_PAGO
            	,COALESCE(T.CNT_DEPTO_PAGO, '0') AS CNT_DEPTO_PAGO
            	,COALESCE(T.CNT_C_POSTAL_PAGO, '0') AS CNT_C_POSTAL_PAGO
            	,COALESCE(T.MIN_CODIGO, '0') AS MIN_CODIGO
            	,COALESCE(T.CNT_ANIO, 0) AS CNT_ANIO
            	,COALESCE(T.CNT_PERIODO, 0) AS CNT_PERIODO
            	,COALESCE(T.CNT_LEGAJO, '0') AS CNT_LEGAJO
            	,COALESCE(T.CNT_CIIU, 0) AS CNT_CIIU
            	,COALESCE(T.URC_CODIGO, 0) AS URC_CODIGO
            	,COALESCE(T.MPA_TIPO_MEDIO_PAGO, '0') AS MPA_TIPO_MEDIO_PAGO
            	,COALESCE(T.CNT_NUMERO_CUENTA, '0') AS CNT_NUMERO_CUENTA
            	,COALESCE(T.CNT_OBSERVACIONES, '0') AS CNT_OBSERVACIONES
            	,T.OIM_TIPO
            	,T.CNT_ESTADO
            	,T.AGF_CODIGO AS 
            	,TRIM(COALESCE(C.CLL_NOMBRE, '0')) AS CLL_NOMBRE
            	,COALESCE(T.CNT_BIS, '0') AS CNT_BIS 
            	,COALESCE(T.CNT_TORRE_PAGO, '0') AS CNT_TORRE_PAGO
            FROM CONTRATOS T
            LEFT JOIN CALLES C
            	ON (C.AGF_CODIGO = T.AGF_CODIGO AND C.CLL_CODIGO = T.CLL_CODIGO)
            WHERE SRV_CODIGO = {$srv_cod}
            	AND CNT_NUMERO = {$cnt_num}
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_srv_cod" value="{$srv_cod}"/>
            <qry:set-variable name="TBL_contratos" value="#ROW:"/>
            <qry:set-variable name="isEmpty_contratos" value="1"/>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="BuscarDomicilioPostal">
        <qry:select dump="0">
            SELECT personas.prs_numero AS prs_numero
            	,substr(personas.prs_razon_social, 1, 25) AS PRS_RAZON_SOCIAL
            	,nvl(personas.prs_direccion, ' ') AS PRS_DIRECCION
            	,personas.cfc_codigo AS CFC_CODIGO
            	,substr(calles.cll_nombre, 1, 18) AS CLL_NOMBRE
            	,substr(nvl(personas.prs_nro, '    '), 1, 4) AS PRS_NRO
            	,substr(nvl(personas.prs_piso, '  '), 1, 2) AS PRS_PISO
            	,substr(nvl(personas.prs_depto, '   '), 1, 3) AS PRS_DEPTO
            	,nvl(personas.prs_torre, ' ') AS PRS_TORRE
            	,nvl(personas.prs_c_postal, ' ') AS PRS_C_POSTAL
            	,personas.agf_codigo AS AGF_CODIGO
            FROM personas
            INNER JOIN calles
            	ON (calles.cll_codigo = personas.cll_codigo AND calles.agf_codigo = personas.agf_codigo)
            WHERE personas.prs_numero = {$l_o_prs_numero}
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="s_srv_agf_nombre" value="0"/>
                <qry:element name="direccionDePago">
                    <qry:attribute name="calle" value="#ROW:/ROW/@CLL_NOMBRE" length="12" align="left"/>
                    <qry:attribute name="nro" value="#ROW:/ROW/@PRS_NRO" length="4" align="left"/>
                    <qry:attribute name="piso" value="#ROW:/ROW/@PRS_PISO" length="2" align="left"/>
                    <qry:attribute name="depto" value="#ROW:/ROW/@PRS_DEPTO" length="3" align="left"/>
                    <qry:attribute name="torre" value="#ROW:/ROW/@PRS_TORRE" length="3" align="left"/>
                    <qry:if left="#ROW:/ROW/@PRS_C_POSTAL" operator="not-equal" right="0" type="string">
                        <qry:attribute name="cod_postal" value=" {#ROW:/ROW/@PRS_C_POSTAL}"/>
                        <qry:insert-query name="BuscaAreaGeografica" doc-param="#ROW:"/>
                        <qry:if left="{$srv_agf_nombre}" operator="not-equal" right="0" type="string"> 
                            <qry:attribute name="area_geografica" value="{$s_srv_agf_nombre}"/>
                        </qry:if>
                    </qry:if>
                </qry:element>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Servicios" > 
        <qry:out>
            <qry:if left="$isEmpty_servicios" operator="equal" right="0" type="integer">
                <qry:insert-query name="QueryServicios"/>
            <qry:else/>
                <qry:if left="$actual_srv_cod" operator="not-equal" right="$srv_cod" type="integer">
                    <qry:insert-query name="QueryServicios"/>
                </qry:if>
            </qry:if>
            <qry:element name="servicio">
            <qry:for-each-row  doc="$TBL_servicios:">
                <qry:set-variable name="s_srv_agf_nombre" value="0"/>
                
                    <qry:if left="{$v_columna}" operator="equal" right="SRV_CODIGO" type="string"> 
                        <qry:if left="{$srv_cod}" operator="greater" right="0" type="integer">
                            <qry:attribute name="cod" value="$srv_cod" length="$largos" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                        </qry:if>
                    <qry:else/>
                        <qry:if left="{$v_columna}" operator="equal" right="SCF_CODIGO" type="string"> 
                            <qry:if left="#ROW:/ROW/@SCF_CODIGO" operator="greater" right="0" type="integer">
                                <qry:attribute name="scf_codigo" value="#ROW:/ROW/@SCF_CODIGO" length="$largos" align="left"/>
                            <qry:else/>
                                <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                            </qry:if>
                        <qry:else/>
                            <qry:if left="{$v_columna}" operator="equal" right="AGE_CODIGO" type="string"> 
                                <qry:attribute name="age_codigo" value="#ROW:/ROW/@AGE_CODIGO" length="$largos" align="left"/>
                            <qry:else/>
                                <qry:if left="{$v_columna}" operator="equal" right="RTA_CODIGO" type="string"> 
                                    <qry:if left="#ROW:/ROW/@RTA_CODIGO" operator="greater" right="0" type="integer">
                                        <qry:attribute name="rta_codigo" value="#ROW:/ROW/@RTA_CODIGO" length="$largos" align="left"/>
                                    <qry:else/>
                                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                    </qry:if>
                                <qry:else/>
                                    <qry:if left="{$v_columna}" operator="equal" right="SRV_ORDEN_LECTURA" type="string"> 
                                        <qry:if left="#ROW:/ROW/@SRV_ORDEN_LECTURA" operator="greater" right="0" type="integer">
                                            <qry:attribute name="orden_lectura" value="#ROW:/ROW/@SRV_ORDEN_LECTURA" length="$largos" align="left"/>
                                        <qry:else/>
                                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                        </qry:if>
                                    <qry:else/>
                                        <qry:if left="{$v_columna}" operator="equal" right="SRV_DIRECCION" type="string"> 
                                            <qry:element name="srv_direccion">
                                                <qry:if left="{$srv_cod}" operator="equal" right="0" type="integer">
                                                    <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                <qry:else/>
                                                    <!-- logica complicada direccion -->
                                                    <qry:attribute name="calle" value="#ROW:/ROW/@CLL_NOMBRE"/>
                                                    <qry:if left="#ROW:/ROW/@SRV_BIS" operator="not-equal" right="0" type="string">
                                                        <qry:if left="#ROW:/ROW/@SRV_BIS" operator="not-equal" right="N" type="string">
                                                            <qry:attribute name="bis" value="#ROW:/ROW/@SRV_BIS"/>
                                                        </qry:if>
                                                    </qry:if>
                                                    <qry:if left="#ROW:/ROW/@SRV_NRO" operator="greater" right="0" type="integer">
                                                        <qry:attribute name="nro" value="#ROW:/ROW/@SRV_NRO"/>
                                                    </qry:if>
                                                    <qry:if left="#ROW:/ROW/@SRV_TORRE" operator="not-equal" right="0" type="string">
                                                        <qry:attribute name="torre" value="#ROW:/ROW/@SRV_TORRE"/>
                                                    </qry:if>
                                                    <qry:if left="#ROW:/ROW/@SRV_PISO" operator="not-equal" right="0" type="string">
                                                        <qry:attribute name="piso" value="#ROW:/ROW/@SRV_PISO"/>
                                                    </qry:if>
                                                    <qry:if left="#ROW:/ROW/@SRV_DEPTO" operator="not-equal" right="0" type="string">
                                                        <qry:attribute name="depto" value="#ROW:/ROW/@SRV_DEPTO"/>
                                                    </qry:if>
                                                    <qry:if left="#ROW:/ROW/@SRV_C_POSTAL" operator="not-equal" right="0" type="string">
                                                        <qry:attribute name="cod_postal" value="#ROW:/ROW/@SRV_C_POSTAL"/>
                                                        <qry:insert-query name="BuscaAreaGeografica" doc-param="#ROW:"/>
                                                        <qry:if left="{$s_srv_agf_nombre}" operator="not-equal" right="0" type="string"> 
                                                            <qry:attribute name="area_geografica" value="$s_srv_agf_nombre"/>
                                                        </qry:if>
                                                    </qry:if>
                                                    <!-- logica complicada direccion-->
                                                </qry:if>
                                            </qry:element>
                                        <qry:else/>
                                            <qry:if left="{$v_columna}" operator="equal" right="SRV_CALLE" type="string"> 
                                                <qry:attribute name="calle" value="#ROW:/ROW/@SRV_CALLE" length="$largos" align="left"/>
                                            <qry:else/>
                                                <qry:if left="{$v_columna}" operator="equal" right="SRV_NRO" type="string"> 
                                                    <qry:if left="#ROW:/ROW/@SRV_NRO" operator="greater" right="0" type="integer">
                                                        <qry:attribute name="nro" value="#ROW:/ROW/@SRV_NRO" length="$largos" align="left"/>
                                                    <qry:else/>
                                                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                    </qry:if>
                                                <qry:else/>
                                                    <qry:if left="{$v_columna}" operator="equal" right="SRV_PISO" type="string"> 
                                                        <qry:attribute name="piso" value="#ROW:/ROW/@SRV_PISO" length="$largos" align="left"/>
                                                    <qry:else/>
                                                        <qry:if left="{$v_columna}" operator="equal" right="SRV_DEPTO" type="string"> 
                                                            <qry:attribute name="depto" value="#ROW:/ROW/@SRV_DEPTO" length="$largos" align="left"/>
                                                        <qry:else/>
                                                            <qry:if left="{$v_columna}" operator="equal" right="SRV_C_POSTAL" type="string"> 
                                                                <qry:if left="#ROW:/ROW/@SRV_C_POSTAL" operator="greater" right="0" type="integer">
                                                                    <qry:attribute name="cod_postal" value="#ROW:/ROW/@SRV_C_POSTAL" length="$largos" align="left"/>
                                                                <qry:else/>
                                                                    <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                </qry:if>
                                                            <qry:else/>
                                                                <qry:if left="{$v_columna}" operator="equal" right="AGF_CODIGO" type="string"> 
                                                                    <qry:if left="#ROW:/ROW/@AGF_CODIGO" operator="greater" right="0" type="integer">
                                                                        <qry:attribute name="agf_codigo" value="#ROW:/ROW/@AGF_CODIGO" length="$largos" align="left"/>
                                                                    <qry:else/>
                                                                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                    </qry:if>
                                                                <qry:else/>
                                                                    <qry:if left="{$v_columna}" operator="equal" right="SRV_FECHA_INSTAL" type="string"> 
                                                                        <qry:attribute name="fecha_instal" value="#ROW:/ROW/@SRV_FECHA_INSTAL" length="$largos" align="left"/>
                                                                    <qry:else/>
                                                                        <qry:if left="{$v_columna}" operator="equal" right="SRV_FECHA_BAJA" type="string"> 
                                                                            <qry:attribute name="fecha_baja" value="#ROW:/ROW/@SRV_FECHA_BAJA" length="$largos" align="left"/>
                                                                        <qry:else/>
                                                                            <qry:if left="{$v_columna}" operator="equal" right="SRV_MOTIVO_BAJA" type="string"> 
                                                                                <qry:attribute name="motivo_baja" value="#ROW:/ROW/@SRV_MOTIVO_BAJA" length="$largos" align="left"/>
                                                                            <qry:else/>
                                                                                <qry:if left="{$v_columna}" operator="equal" right="SRV_SUMINISTRO_ORIGINAL" type="string"> 
                                                                                    <qry:if left="#ROW:/ROW/@SRV_SUMINISTRO_ORIGINAL" operator="greater" right="0" type="integer">
                                                                                        <qry:attribute name="suministro_original" value="#ROW:/ROW/@SRV_SUMINISTRO_ORIGINAL" length="$largos" align="left"/>
                                                                                    <qry:else/>
                                                                                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                                    </qry:if>
                                                                                <qry:else/>
                                                                                    <qry:if left="{$v_columna}" operator="equal" right="EDI_NUMERO" type="string"> 
                                                                                        <qry:if left="#ROW:/ROW/@EDI_NUMERO" operator="greater" right="0" type="integer">
                                                                                            <qry:attribute name="edi_numero" value="#ROW:/ROW/@EDI_NUMERO" length="$largos" align="left"/>
                                                                                        <qry:else/>
                                                                                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                                        </qry:if>
                                                                                    <qry:else/>
                                                                                        <qry:if left="{$v_columna}" operator="equal" right="SRV_ZONA_CAT" type="string"> 
                                                                                            <qry:attribute name="zona_cat" value="#ROW:/ROW/@SRV_ZONA_CAT" length="$largos" align="left"/>
                                                                                        <qry:else/>
                                                                                            <qry:if left="{$v_columna}" operator="equal" right="SRV_MANZANA_CAT" type="string"> 
                                                                                                <qry:attribute name="manzana_cat" value="#ROW:/ROW/@SRV_MANZANA_CAT" length="$largos" align="left"/>
                                                                                            <qry:else/>
                                                                                                <qry:if left="{$v_columna}" operator="equal" right="SRV_LOTE_CAT" type="string"> 
                                                                                                    <qry:attribute name="lote_cat" value="#ROW:/ROW/@SRV_LOTE_CAT" length="$largos" align="left"/>
                                                                                                <qry:else/>
                                                                                                    <qry:if left="{$v_columna}" operator="equal" right="SRV_ESTADO" type="string"> 
                                                                                                        <qry:attribute name="estado" value="#ROW:/ROW/@SRV_ESTADO" length="$largos" align="left"/>
                                                                                                    <qry:else/>
                                                                                                        <qry:if left="{$v_columna}" operator="equal" right="SRV_OBSERVACIONES" type="string"> 
                                                                                                            <qry:attribute name="observaciones" value="#ROW:/ROW/@SRV_OBSERVACIONES" length="$largos" align="left"/>
                                                                                                        <qry:else/>
                                                                                                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                                                                                        </qry:if>
                                                                                                    </qry:if>
                                                                                                </qry:if>
                                                                                            </qry:if>
                                                                                        </qry:if>
                                                                                    </qry:if>
                                                                                </qry:if>
                                                                            </qry:if>
                                                                        </qry:if>
                                                                    </qry:if>
                                                                </qry:if>
                                                            </qry:if>
                                                        </qry:if>
                                                    </qry:if>
                                                </qry:if>
                                            </qry:if>
                                        </qry:if>
                                    </qry:if>
                                </qry:if>
                            </qry:if>
                        </qry:if>
                    </qry:if>
            </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="QueryServicios" > 
        <qry:select dump="0">
            SELECT S.SCF_CODIGO
                  ,COALESCE(S.AGE_CODIGO, '0') AS AGE_CODIGO
                  ,S.RTA_CODIGO
                  ,COALESCE(S.SRV_ORDEN_LECTURA, 0) AS SRV_ORDEN_LECTURA
                  ,COALESCE(S.SRV_BIS, '0') AS SRV_BIS
                  ,COALESCE(S.SRV_NRO, 0) AS SRV_NRO
                  ,COALESCE(S.SRV_TORRE, '0') AS SRV_TORRE
                  ,COALESCE(S.SRV_PISO, '0') AS SRV_PISO
                  ,COALESCE(S.SRV_DEPTO, '0') AS SRV_DEPTO
                  ,COALESCE(LPAD(S.SRV_C_POSTAL, 4, '0'), '0') AS SRV_C_POSTAL
                  ,S.AGF_CODIGO
                  ,COALESCE(to_char(S.SRV_FECHA_INSTAL, 'dd/mm/yy'), '0') AS SRV_FECHA_INSTAL
                  ,COALESCE(to_char(S.SRV_FECHA_BAJA, 'dd/mm/yy'), '0') AS SRV_FECHA_BAJA 
                  ,COALESCE(S.SRV_MOTIVO_BAJA, '0') AS SRV_MOTIVO_BAJA
                  ,COALESCE(S.SRV_SUMINISTRO_ORIGINAL, 0) AS SRV_SUMINISTRO_ORIGINAL
                  ,COALESCE(S.EDI_NUMERO, 0) AS EDI_NUMERO
                  ,COALESCE(S.SRV_ZONA_CATA, 0) AS SRV_ZONA_CATA
                  ,COALESCE(S.SRV_MANZANA_CATA, 0) AS SRV_MANZANA_CATA
                  ,COALESCE(S.SRV_LOTE_CATA, 0) AS SRV_LOTE_CATA
                  ,S.SRV_ESTADO
                  ,COALESCE(S.SRV_OBSERVACIONES, '0') AS SRV_OBSERVACIONES
                  ,TRIM(COALESCE(C.CLL_NOMBRE, '0')) AS CLL_NOMBRE
                FROM SERVICIOS S
                LEFT JOIN CALLES C 
                	ON (C.AGF_CODIGO = S.AGF_CODIGO AND C.CLL_CODIGO = S.CLL_CODIGO)
                WHERE SRV_CODIGO = {$srv_cod}
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_srv_cod" value="$srv_cod"/>
            <qry:set-variable name="TBL_servicios" value="#ROW:"/>
            <qry:set-variable name="isEmpty_servicios" value="1"/>
        </qry:out>
    </qry:query>

    <qry:query name="BuscaAreaGeografica">
        <qry:select dump="0">
            SELECT COALESCE(AGF_NOMBRE, '0') AS AGF_NOMBRE
            FROM AREAS_GEOGRAFICAS
            WHERE AREAS_GEOGRAFICAS.AGF_CODIGO = {#PARAM:/ROW/@AGF_CODIGO}
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="s_srv_agf_nombre" value="#ROW:/ROW/@AGF_NOMBRE"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Lecturas">
        <qry:out>
            <qry:if left="$isEmpty_lecturas" operator="equal" right="0" type="integer">
                <qry:insert-query name="QueryLecturas"/>
            <qry:else/>
                <qry:if left="$actual_srv_cod" operator="not-equal" right="$srv_cod" type="integer">
                    <qry:insert-query name="QueryLecturas"/>
                </qry:if>
            </qry:if>
            <qry:element name="lectura">
                <qry:for-each-row  doc="$TBL_lecturas:">
                    <qry:if left="{$v_columna}" operator="equal" right="LCT_VALOR_LEIDO" type="string"> 
                        <qry:if left="#ROW:/ROW/@LCT_VALOR_LEIDO" operator="greater" right="0" type="double">
                            <qry:attribute name="valor_leido" value="#ROW:/ROW/@LCT_VALOR_LEIDO" length="$largos" align="left" format-number=".3"/>
                        <qry:else/>
                            <qry:attribute name="valor_leido" value="" length="$largos" align="left"/>
                        </qry:if>
                    <qry:else/>
                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                    </qry:if>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="QueryLecturas" > 
        <qry:select dump="0">
            SELECT TO_CHAR(LCT_VALOR_LEIDO,'9999999999990.0000') AS LCT_VALOR_LEIDO
            FROM LECTURAS
            WHERE LCT_CODIGO IN (
            		SELECT max(LCT_CODIGO)
            		FROM LECTURAS
            		WHERE SRV_CODIGO = {$srv_cod}
            		)
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_srv_cod" value="$srv_cod"/>
            <qry:set-variable name="TBL_lecturas" value="#ROW:"/>
            <qry:set-variable name="isEmpty_lecturas" value="1"/>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Ordenativos"> 
        <qry:out>
            <qry:if left="{$isEmpty_ordenativos}" operator="equal" right="0" type="integer">
                <qry:insert-query name="QueryOrdenativos"/>
            <qry:else/>
                <qry:if left="{$actual_nro_ord}" operator="equal" right="{$nro_ord}" type="integer">
                    <qry:insert-query name="QueryOrdenativos"/>
                </qry:if>
            </qry:if>
            <qry:element name="ordenativo">
                <qry:for-each-row  doc="$TBL_ordenativos:">
                    <qry:set-variable name="ord_fec" value="{#ROW:/ROW/@ORD_FECHA_GENERACION}"/>
                    <qry:set-variable name="srv_cod_temp" value="{$srv_cod}"/>
                    <qry:if left="{#ROW:/ROW/@SRV_CODIGO_ORIGEN}" operator="equal" right="0" type="integer">
                        <qry:set-variable name="srv_cod" value="0"/>
                    <qry:else/>
                        <qry:set-variable name="srv_cod" value="{#ROW:/ROW/@SRV_CODIGO_ORIGEN}"/>
                    </qry:if>
                    <qry:set-variable name="cnt_num_temp" value="{$cnt_num}"/>
                    <qry:if left="{#ROW:/ROW/@CNT_NUMERO_ORIGEN}" operator="equal" right="0" type="integer">
                        <qry:set-variable name="cnt_num" value="0"/>
                    <qry:else/>
                        <qry:set-variable name="cnt_num" value="{#ROW:/ROW/@CNT_NUMERO_ORIGEN}"/>
                    </qry:if>
                    <qry:set-variable name="trt_num_temp" value="{$trt_num}"/>
                    <qry:if left="{#ROW:/ROW/@TRT_NUMERO_ORIGEN}" operator="equal" right="0" type="integer">
                        <qry:set-variable name="trt_num" value="0"/>
                    <qry:else/>
                        <qry:set-variable name="trt_num" value="{#ROW:/ROW/@TRT_NUMERO_ORIGEN}"/>
                    </qry:if>
                
                    <qry:if left="{$v_columna}" operator="equal" right="ORD_NUMERO" type="string">
                        <qry:if left="{$nro_ord}" operator="greater" right="0" type="integer">
                            <qry:attribute name="nro_ord" value="$nro_ord" length="$largos" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                        </qry:if>
                    <qry:else/>
                        <qry:if left="{$v_columna}" operator="equal" right="ORD_FECHA_GENERACION" type="string">
                            <qry:attribute name="fecha_generacion" value="{#ROW:/ROW/@ORD_FECHA_GENERACION}" length="$largos" align="left"/>
                        <qry:else/>
                            <qry:if left="{$v_columna}" operator="equal" right="ORD_FECHA_GEN_HABIL_ANT" type="string">
                                <qry:attribute name="fecha_gen_habil_ant" value="{#ROW:/ROW/@ORD_FECHA_GEN_HABIL_ANT}" length="$largos" align="left"/>
                            <qry:else/>
                                <qry:if left="{$v_columna}" operator="equal" right="ORD_FECHA_VENCIMIENTO" type="string">
                                    <qry:attribute name="fecha_vencimiento" value="{#ROW:/ROW/@ORD_FECHA_VENCIMIENTO}" length="$largos" align="left"/>
                                <qry:else/>
                                    <qry:if left="{$v_columna}" operator="equal" right="ORD_DATOS_ADICIONALES" type="string">
                                        <qry:attribute name="datos_adicionales" value="{#ROW:/ROW/@ORD_DATOS_ADICIONALES}" length="$largos" align="left"/>
                                    <qry:else/>
                                        <qry:if left="{$v_columna}" operator="equal" right="SRV_CODIGO" type="string">
                                            <qry:if left="#ROW:/ROW/@SRV_CODIGO" operator="greater" right="0" type="integer">
                                                <qry:attribute name="srv_codigo" value="{#ROW:/ROW/@SRV_CODIGO}" length="$largos" align="left"/>
                                            <qry:else/>
                                                <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                            </qry:if>
                                        <qry:else/>
                                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                                        </qry:if>
                                    </qry:if>
                                </qry:if>
                            </qry:if>
                        </qry:if>
                    </qry:if>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="QueryOrdenativos"> 
        <qry:select dump="0">
            SELECT to_char(ORD_FECHA_GENERACION, 'dd/mm/yyyy') AS ORD_FECHA_GENERACION
              ,to_char(fun_habil_anterior(1, ORD_FECHA_GENERACION), 'dd/mm/yyyy') AS ORD_FECHA_GEN_HABIL_ANT
              ,COALESCE(to_char(ORD_FECHA_VENCIMIENTO, 'dd/mm/yyyy'), '0') AS ORD_FECHA_VENCIMIENTO
              ,COALESCE(SRV_CODIGO_ORIGEN, 0) AS SRV_CODIGO_ORIGEN
              ,COALESCE(CNT_NUMERO_ORIGEN, 0) AS CNT_NUMERO_ORIGEN
              ,COALESCE(TRT_NUMERO_ORIGEN, 0) AS TRT_NUMERO_ORIGEN
              ,COALESCE(ORD_DATOS_ADICIONALES, '0') AS ORD_DATOS_ADICIONALES
              ,SRV_CODIGO AS SRV_CODIGO
            FROM ORDENATIVOS
            WHERE ORD_NUMERO = {$nro_ord}
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_nro_ord" value="$nro_ord"/>
            <qry:set-variable name="TBL_ordenativos" value="#ROW:"/>
            <qry:set-variable name="isEmpty_ordenativos" value="1"/>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="TiposOrdenativo"> 
        <qry:out>
            <qry:element name="tipoOrdenativo">
                <qry:if left="{$v_columna}" operator="equal" right="TOR_DESCRIPCION" type="string">    
                    <qry:attribute name="descripcion" value="$l_tor_descripcion"/>
                <qry:else/>
                    <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                </qry:if>
            </qry:element>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Potencias"> 
        <qry:out>
            <qry:if left="$isEmpty_potencias" operator="equal" right="0" type="integer">
                <qry:insert-query name="QueryPotencias"/>
            <qry:else/>
                <qry:if left="$actual_srv_cod" operator="not-equal" right="$srv_cod" type="integer">
                    <qry:insert-query name="QueryPotencias"/>
                </qry:if>
            </qry:if>
            <qry:element name="potencia">
                <qry:for-each-row  doc="$TBL_potencias:">
                    <qry:if left="{$v_columna}" operator="equal" right="POT_VALOR" type="string">
                        <qry:attribute name="valor" value="{#ROW:/ROW/@POT_VALOR}" length="$largos" align="left" format-number=" 2"/>
                    <qry:else/>
                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                    </qry:if>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="QueryPotencias" > 
        <qry:select dump="0">
            SELECT TO_CHAR(POT_VALOR, '9999999999990.0000') AS POT_VALOR
            FROM POTENCIAS
            WHERE SRV_CODIGO = {$srv_cod}
	            AND CNT_NUMERO = {$cnt_num}
	            AND CDR_UNIDAD IN ('DA')
	            AND POT_ORIGEN IN ('C')
	            AND POT_FECHA IN (
	            	SELECT max(POT_FECHA)
	            	FROM POTENCIAS
	            	WHERE SRV_CODIGO = {$srv_cod}
	            		AND CNT_NUMERO = {$cnt_num}
	            		AND CDR_UNIDAD IN ('DA')
	            		AND POT_ORIGEN IN ('C')
	            	)
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_srv_cod" value="$srv_cod"/>
            <qry:set-variable name="TBL_potencias" value="#ROW:"/>
            <qry:set-variable name="isEmpty_potencias" value="1"/>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Stock_Equipos"> 
        <qry:out>
            <qry:if left="$isEmpty_stock_equipos" operator="equal" right="0" type="integer">
                <qry:insert-query name="QueryStock_Equipos"/>
            <qry:else/>
                <qry:if left="$actual_srv_cod" operator="not-equal" right="$srv_cod" type="integer">
                    <qry:insert-query name="QueryStock_Equipos"/>
                </qry:if>
            </qry:if>
            <qry:element name="stock_equipos">
                <qry:for-each-row  doc="$TBL_stock_equipos:">
                    <qry:if left="{$v_columna}" operator="equal" right="STE_NUMERO" type="string">
                        <qry:attribute name="numero" value="#ROW:/ROW/@STE_NUMERO" length="$largos" align="left" format-number=" 2"/>
                    <qry:else/>
                        <qry:if left="{$v_columna}" operator="equal" right="STE_TIPO" type="string">
                            <qry:attribute name="tipo" value="#ROW:/ROW/@STE_TIPO" length="$largos" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                        </qry:if>
                    </qry:if>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="QueryStock_Equipos" > 
        <qry:select dump="0">
            SELECT TO_CHAR(S.STE_NUMERO, '9999999999990.0000') AS STE_NUMERO
            	,S.STE_TIPO AS STE_TIPO
            FROM STOCK_EQUIPOS S
            INNER JOIN EQUIPOS E
            	ON (S.STE_NUMERO = E.STE_NUMERO AND S.STE_TIPO = E.STE_TIPO)
            WHERE E.SRV_CODIGO = {$srv_cod}
            	AND E.EQP_ESTADO IS NULL
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_srv_cod" value="$srv_cod"/>
            <qry:set-variable name="TBL_stock_equipos" value="#ROW:"/>
            <qry:set-variable name="isEmpty_stock_equipos" value="1"/>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Sucursales"> 
        <qry:out>
            <qry:if left="$isEmpty_sucursales" operator="equal" right="0" type="integer">
                <qry:insert-query name="QuerySucursales"/>
            <qry:else/>
                <qry:if left="$actual_scf_cod" operator="not-equal" right="$scf_cod" type="integer">
                    <qry:insert-query name="QuerySucursales"/>
                </qry:if>
            </qry:if>
            <qry:element name="sucursal">
                <qry:for-each-row  doc="$TBL_sucursales:">
                    <qry:if left="{$v_columna}" operator="equal" right="SCF_DESCRIPCION" type="string">
                        <qry:attribute name="descripcion" value="#ROW:/ROW/@SCF_DESCRIPCION" length="$largos" align="left"/>
                    <qry:else/>
                        <qry:if left="{$v_columna}" operator="equal" right="SCF_DIRECCION" type="string">
                            <qry:attribute name="direccion" value="#ROW:/ROW/@SCF_DIRECCION" length="$largos" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                        </qry:if>
                    </qry:if>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="QuerySucursales" > 
        <qry:select dump="0">
            SELECT SCF_DESCRIPCION AS SCF_DESCRIPCION
            	,SCF_DIRECCION AS SCF_DIRECCION
            FROM SUCURSALES
            WHERE SCF_CODIGO = {$scf_cod}
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_scf_cod" value="$scf_cod"/>
            <qry:set-variable name="TBL_sucursales" value="#ROW:"/>
            <qry:set-variable name="isEmpty_sucursales" value="1"/>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Bancos"> 
        <qry:out>
            <qry:if left="$isEmpty_bancos" operator="equal" right="0" type="integer">
                <qry:insert-query name="QueryBancos"/>
            <qry:else/>
                <qry:if left="$actual_agf_cod" operator="not-equal" right="$agf_cod" type="integer">
                    <qry:insert-query name="QueryBancos"/>
                </qry:if>
            </qry:if>
            <qry:element name="banco">
                <qry:for-each-row  doc="$TBL_bancos:">
                    <qry:attribute name="descripcion" value="#ROW:/ROW/@URC_DESCRIPCION_ALT" length="$largos" align="left" />
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>
    
    <qry:query name="QueryBancos" > 
        <qry:select dump="0">
            SELECT U.URC_DESCRIPCION_ALT AS URC_DESCRIPCION_ALT
            FROM UNIDADES_REC_COBRO C
            INNER JOIN UNIDADES_RECAUDADORAS U 
              ON U.URC_CODIGO = C.URC_CODIGO
            WHERE C.UCO_TIPO = 'A'
              AND C.AGF_CODIGO = {$agf_cod}
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_agf_cod" value="$agf_cod"/>
            <qry:set-variable name="TBL_bancos" value="#ROW:"/>
            <qry:set-variable name="isEmpty_bancos" value="1"/>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Cargos"> 
        <qry:out>
            <qry:if left="{$ord_fec}" operator="not-equal" right="0" type="string">
                <!-- Aca va logica para llamar 3 procesos -->
                <qry:if left="{$v_columna}" operator="equal" right="CARGO_AVISO" type="string"> 
                    <qry:insert-query name="CargosAvisoDeuda"/>
                <qry:else/>
                    <qry:if left="{$v_columna}" operator="equal" right="CARGO_TELEGRAMA" type="string"> 
                        <qry:insert-query name="CargosCartaDoc"/>
                    <qry:else/>
                        <qry:if left="{$v_columna}" operator="equal" right="CARGO_RECONEXION" type="string">
                            <qry:insert-query name="CargosReconexion"/>
                        <qry:else/>
                            <qry:element name="cargos">
                                <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                            </qry:element>
                        </qry:if>
                    </qry:if>
                </qry:if>
            <qry:else/>
                <qry:element name="cargos">
                    <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                </qry:element>
            </qry:if>
        </qry:out>
    </qry:query>

    <qry:query name="CargosAvisoDeuda"> 
        <qry:select dump="0">
            SELECT 'Cargo por ' || 'aviso de deuda             ' || ': $' || TO_CHAR(PPR_PRECIO, '9990.00') || ' m^225!s IVA' AS CARGOMSG
            FROM PRECIOS_PRESTACION
            WHERE TIT_CLAVE = 'ND1'
              AND PPR_FECHA_VIGENCIA = (
                SELECT MAX(PPR_FECHA_VIGENCIA)
                FROM PRECIOS_PRESTACION
                WHERE TIT_CLAVE = 'ND1'
                  AND PPR_FECHA_VIGENCIA &lt;= TO_DATE({$ord_fec}, 'DD/MM/YYYY')
                )
        </qry:select>
        <qry:out>
            <qry:element name="cargos">
                <qry:for-each-row>        
                    <qry:attribute name="aviso" value="#ROW:/ROW/@CARGOMSG" length="$largos" align="left"/>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="CargosCartaDoc"> 
        <qry:select dump="0">
            SELECT 'Cargo por ' || 'carta documento o telegrama' || ': $' || TO_CHAR(PPR_PRECIO, '9990.00') || ' m^225!s IVA' AS CARGOMSG
            FROM PRECIOS_PRESTACION
            WHERE TIT_CLAVE = 'ND2'
              AND PPR_FECHA_VIGENCIA = (
                SELECT MAX(PPR_FECHA_VIGENCIA)
                FROM PRECIOS_PRESTACION
                WHERE TIT_CLAVE = 'ND2'
                  AND PPR_FECHA_VIGENCIA &lt;= TO_DATE({$ord_fec}, 'DD/MM/YYYY')
                )
        </qry:select>
        <qry:out>
            <qry:element name="cargos">
                <qry:for-each-row>        
                    <qry:attribute name="telegrama" value="#ROW:/ROW/@CARGOMSG" length="$largos" align="left"/>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="CargosReconexion"> 
        <qry:select dump="0">
            <!-- SELECT 'Cargo por ' || 'reconexin                 ' || ': $' || TO_CHAR(PPR_PRECIO, '9990.00') || ' ms IVA' AS CARGOMSG -->
            SELECT 'Cargo por ' || 'reconexi^243!n                 ' || ': $' || TO_CHAR(PPR_PRECIO, '9990.00') || ' m^225!s IVA' AS CARGOMSG
            FROM PRECIOS_PRESTACION
            WHERE TIT_CLAVE = 'TR1'
              AND PPR_FECHA_VIGENCIA = (
                SELECT MAX(PPR_FECHA_VIGENCIA)
                FROM PRECIOS_PRESTACION
                WHERE TIT_CLAVE = 'TR1'
                  AND PPR_FECHA_VIGENCIA &lt;= TO_DATE({$ord_fec}, 'DD/MM/YYYY')
                )
        </qry:select>
        <qry:out>
            <qry:element name="cargos">
                <qry:for-each-row>        
                    <qry:attribute name="reconexion" value="#ROW:/ROW/@CARGOMSG" length="$largos" align="left"/>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Tipos_IVA"> 
        <qry:out>
            <qry:if left="$isEmpty_tipos_iva" operator="equal" right="0" type="integer">
                <qry:insert-query name="QueryTipos_IVA"/>
            <qry:else/>
                <qry:if left="$actual_ivv_cod" operator="equal" right="$ivv_cod" type="integer">
                    <qry:insert-query name="QueryTipos_IVA"/>
                </qry:if>
            </qry:if>
            <qry:element name="tipoIVA">
                <qry:for-each-row  doc="$TBL_tipos_iva:">
                    <qry:if left="{$v_columna}" operator="equal" right="TCL_DESCRIPCION" type="string">
                        <qry:attribute name="ivv_descripcion" value="#ROW:/ROW/@IVV_DESCRIPCION" length="$largos" align="left"/>
                    <qry:else/>
                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                    </qry:if>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="QueryTipos_IVA" > 
        <qry:select dump="0">
            SELECT IVV_DESCRIPCION AS IVV_DESCRIPCION
            FROM TIPOS_IVA
            WHERE IVV_CODIGO = {$ivv_cod}
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_ivv_cod" value="$ivv_cod"/>
            <qry:set-variable name="TBL_tipos_iva" value="#ROW:"/>
            <qry:set-variable name="isEmpty_tipos_iva" value="1"/>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Tarifas"> 
        <qry:out>
            <qry:if left="$isEmpty_tarifas" operator="equal" right="0" type="integer">
                <qry:insert-query name="QueryTarifas"/>
            <qry:else/>
                <qry:if left="$actual_tcl_cod" operator="equal" right="$tcl_cod" type="integer">
                    <qry:insert-query name="QueryTarifas"/>
                </qry:if>
            </qry:if>

            <qry:element name="tarifa">
                <qry:for-each-row  doc="$TBL_tarifas:">
                    <qry:if left="{$v_columna}" operator="equal" right="TCL_DESCRIPCION" type="string">
                        <qry:attribute name="tcl_descripcion" value="#ROW:/ROW/@TCL_DESCRIPCION" length="$largos" align="left"/>
                    <qry:else/>
                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                    </qry:if>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="QueryTarifas" > 
        <qry:select dump="0">
            SELECT TCL_DESCRIPCION AS TCL_DESCRIPCION
            FROM TARIFAS
            WHERE TCL_CODIGO = {$tcl_cod}
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_tcl_cod" value="$tcl_cod"/>
            <qry:set-variable name="TBL_tarifas" value="#ROW:"/>
            <qry:set-variable name="isEmpty_tarifas" value="1"/>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Documentos"> 
        <qry:out>
            <qry:if left="$document_tbl_type" operator="equal" right="DOC" type="string">
                <qry:if left="$isEmpty_documentos_doc" operator="equal" right="0" type="integer">
                    <qry:insert-query name="QueryDocumentos"/>
                <qry:else/>
                    <qry:if left="$actual_nro_ord" operator="equal" right="$nro_ord" type="integer">
                        <qry:insert-query name="QueryDocumentos"/>
                    </qry:if>
                </qry:if>
            <qry:else/>
                <qry:if left="$isEmpty_documentos_ori" operator="equal" right="0" type="integer">
                    <qry:insert-query name="QueryDocumentos"/>
                <qry:else/>
                    <qry:if left="$actual_nro_ord" operator="equal" right="$nro_ord" type="integer">
                        <qry:insert-query name="QueryDocumentos"/>
                    </qry:if>
                </qry:if>
            </qry:if>
            <qry:element name="documento">
                <qry:set-variable name="t_doc_saldo" value="0"/>
                <qry:for-each-row  doc="$TBL_documentos:">
                    <qry:element name="item">
                        <qry:set-variable name="nro_linea" value="1" operation="+"/>
                        <qry:set-variable name="t_doc_saldo" value="#ROW:/ROW/@DOC_SALDO" operation="+"/> 
                        <qry:if left="{$srv_cod}" operator="greater" right="0" type="integer">
                            <qry:attribute name="srv_cod" value="$srv_cod" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>
                        <qry:if left="{$cnt_num}" operator="greater" right="0" type="integer">
                            <qry:attribute name="cnt_num" value="$cnt_num" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>    
                        <qry:attribute name="tipo" value="#ROW:/ROW/@DOC_TIPO" length="3" align="left"/>
                        <qry:if left="#ROW:/ROW/@DOC_TIPO" operator="equal" right="FN" type="string">
                            <qry:set-variable name="Tiene_Comprobantes_Financiaciones" value="1" operation="+"/>
                        <qry:else/>
                            <qry:if left="#ROW:/ROW/@DOC_TIPO" operator="equal" right="DN" type="string">
                                <qry:set-variable name="Tiene_Comprobantes_Financiaciones" value="1" operation="+"/>
                            <qry:else/>
                                <qry:set-variable name="Tiene_Otros_Comprobantes" value="1" operation="+"/>
                            </qry:if>
                        </qry:if>
                        <qry:if left="#ROW:/ROW/@DOC_NUMERO" operator="greater" right="0" type="integer">
                            <qry:attribute name="numero" value="#ROW:/ROW/@DOC_NUMERO" length="12" align="left"/>
                            <qry:set-variable name="CantidadDeFacturas" value="1" operation="+"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>
                        <qry:attribute name="fecha_emision" value="#ROW:/ROW/@DOC_FECHA_EMISION" length="12" align="left"/>
                        <qry:if left="#ROW:/ROW/@DOC_PERIODO" operator="greater" right="0" type="integer">
                            <qry:attribute name="periodo" value="{#ROW:/ROW/@DOC_PERIODO}/{#ROW:/ROW/@DOC_ANIO}" length="9" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>
                        <qry:if left="#ROW:/ROW/@DOC_ANIO" operator="greater" right="0" type="integer">
                            <qry:attribute name="anio" value="#ROW:/ROW/@DOC_ANIO" length="5" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>
                        <qry:if left="#ROW:/ROW/@DOC_CUOTA" operator="greater" right="0" type="integer">
                            <qry:attribute name="cuota" value="#ROW:/ROW/@DOC_CUOTA" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>
                        <qry:attribute name="tipo_origen" value="#ROW:/ROW/@DOC_TIPO_ORIGEN" length="3" align="left"/>
                        <qry:if left="#ROW:/ROW/@DOC_NUMERO_ORIGEN" operator="greater" right="0" type="string">
                            <qry:attribute name="numero_origen" value="#ROW:/ROW/@DOC_NUMERO_ORIGEN" length="12" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>
                        <qry:if left="#ROW:/ROW/@DOC_CONSUMO" operator="greater" right="0" type="integer">
                            <qry:attribute name="consumo" value="#ROW:/ROW/@DOC_CONSUMO" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>
                        <qry:if left="#ROW:/ROW/@ORD_NUMERO" operator="greater" right="0" type="integer">
                            <qry:attribute name="ord_numero" value="#ROW:/ROW/@ORD_NUMERO" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>
                        <qry:attribute name="urc_codigo" value="#ROW:/ROW/@URC_CODIGO" align="left"/>
                        <qry:if left="#ROW:/ROW/@ASI_NUMERO" operator="greater" right="0" type="integer">
                            <qry:attribute name="asi_numero" value="#ROW:/ROW/@ASI_NUMERO" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>
                        <qry:attribute name="importe" value="#ROW:/ROW/@DOC_IMPORTE" align="left" format-number=" 2"/>
                        <qry:set-variable name="ImporteDelAviso" value="#ROW:/ROW/@DOC_IMPORTE_BASICO" operation="+"/>
                        <qry:attribute name="importe_basico" value="#ROW:/ROW/@DOC_IMPORTE_BASICO" align="left" format-number=" 2"/>
                        <qry:attribute name="saldo" value="#ROW:/ROW/@DOC_SALDO" length="12" align="right" format-number=" 2"/>
                        <qry:attribute name="fecha_venc" value="#ROW:/ROW/@DOC_FECHA_VENC" length="12" align="left"/>
                        <qry:attribute name="fecha_venc_1" value="#ROW:/ROW/@DOC_FECHA_VENC_1" length="12" align="left"/>
                        <qry:attribute name="fecha_venc_2" value="#ROW:/ROW/@DOC_FECHA_VENC_2" length="12" align="left"/>
                        <qry:attribute name="recargo_venc_2" value="#ROW:/ROW/@DOC_RECARGO_VENC_2" align="left" format-number=" 2"/>
                        <qry:attribute name="recargo_venc_3" value="#ROW:/ROW/@DOC_RECARGO_VENC_3" align="left" format-number=" 2"/>
                        <qry:attribute name="estado" value="#ROW:/ROW/@DOC_ESTADO" align="left"/>
                        <qry:attribute name="llamada_sit_x" value="#ROW:/ROW/@LLAMADA_SIT_X" length="3" align="left"/>                                                                              
                    </qry:element>
                </qry:for-each-row>
                <!--<qry:set-variable name="num_rows_doc" value="1" operation="-"/>-->
                <qry:while left="$nro_linea" operator="less" right="$num_rows_doc" type="integer">
                    <qry:element name="item">
				        <qry:set-variable name="nro_linea" value="1" operation="+"/>
					    <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                    </qry:element>
			    </qry:while>
                <qry:attribute name="saldo_total" value="{$t_doc_saldo}" format-number=" 2"/>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="QueryDocumentos" > 
        <qry:select dump="0">
            SELECT /*+ rule */ TO_CHAR(d.DOC_NUMERO) AS DOC_NUMERO
            	,d.DOC_TIPO
            	,to_char(d.DOC_FECHA_EMISION, 'dd/mm/yyyy') AS DOC_FECHA_EMISION
            	,COALESCE(d.DOC_PERIODO, 0) AS DOC_PERIODO
            	,COALESCE(d.DOC_ANIO, 0) AS DOC_ANIO
            	,COALESCE(d.DOC_CUOTA, 0) AS DOC_CUOTA
            	,COALESCE(d.DOC_TIPO_ORIGEN, '0') AS DOC_TIPO_ORIGEN
            	,TO_CHAR(COALESCE(d.DOC_NUMERO_ORIGEN, 0)) AS DOC_NUMERO_ORIGEN
            	,COALESCE(d.DOC_CONSUMO, 0) AS DOC_CONSUMO
            	,COALESCE(d.ORD_NUMERO, 0) AS ORD_NUMERO
            	,COALESCE(d.URC_CODIGO, 0) AS URC_CODIGO
            	,COALESCE(d.ASI_NUMERO, 0) AS ASI_NUMERO
            	,TO_CHAR(d.DOC_IMPORTE, '9999999999990.0000') AS DOC_IMPORTE
            	,TO_CHAR(COALESCE(d.DOC_IMPORTE_BASICO, 0), '9999999999990.0000') AS DOC_IMPORTE_BASICO
            	,TO_CHAR(nvl(d.DOC_SALDO, d.DOC_IMPORTE), '9999999999990.0000') AS DOC_SALDO
            	,COALESCE(to_char(d.DOC_FECHA_VENC, 'dd/mm/yy'), '0') AS DOC_FECHA_VENC
            	,COALESCE(to_char(d.DOC_FECHA_VENC_1, 'dd/mm/yyyy'), '0') AS DOC_FECHA_VENC_1
                ,COALESCE(to_char(d.DOC_FECHA_VENC_2, 'dd/mm/yyyy'), '0') AS DOC_FECHA_VENC_2
                ,TO_CHAR(COALESCE(d.DOC_RECARGO_VENC_2, 0), '9999999999990.0000') AS DOC_RECARGO_VENC_2
                ,COALESCE(to_char(d.DOC_FECHA_VENC_3, 'dd/mm/yyyy'), '0') AS DOC_FECHA_VENC_3
                ,TO_CHAR(COALESCE(d.DOC_RECARGO_VENC_3, 0), '9999999999990.0000') AS DOC_RECARGO_VENC_3
                ,d.DOC_ESTADO AS DOC_ESTADO
                ,decode(d.doc_situacion, 'X', '(*)', '   ') LLAMADA_SIT_X
            FROM documentos d
            INNER JOIN documentos_estadistica_view de 
            	ON (d.doc_tipo = de.doc_tipo AND d.doc_numero = de.doc_numero)
            WHERE nvl(nvl(d.DOC_SALDO, d.DOC_IMPORTE), 0) &gt; 0
            	AND de.ord_numero = {$nro_ord}
            	AND d.doc_situacion &lt;&gt; 'X'
                AND ROWNUM &lt; {$num_rows_doc}
            ORDER BY DOC_FECHA_VENC_1
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_nro_ord" value="$nro_ord"/>
            <qry:set-variable name="TBL_documentos" value="#ROW:"/>
            <qry:if left="document_tbl_type" operator="equal" right="DOC" type="string">
                <qry:set-variable name="isEmpty_documentos_doc" value="1"/>
                <qry:set-variable name="isEmpty_documentos_ori" value="0"/>
            <qry:else/>
                <qry:set-variable name="isEmpty_documentos_ori" value="1"/>
                <qry:set-variable name="isEmpty_documentos_doc" value="0"/>
            </qry:if>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="DocumentosD2"> 
        <qry:out>
            <qry:if left="$document_tbl_type" operator="equal" right="DOC" type="string">
                <qry:if left="$isEmpty_documentos_doc" operator="equal" right="0" type="integer">
                    <qry:insert-query name="QueryDocumentosD2"/>
                <qry:else/>
                    <qry:if left="{$actual_trt_num}" operator="equal" right="{$trt_num}" type="integer">
                        <qry:insert-query name="QueryDocumentosD2"/>
                    </qry:if>
                </qry:if>
            <qry:else/>
                <qry:if left="$isEmpty_documentos_ori" operator="equal" right="0" type="integer">
                    <qry:insert-query name="QueryDocumentosD2"/>
                <qry:else/>
                    <qry:if left="{$actual_trt_num}" operator="equal" right="{$trt_num}" type="integer">
                        <qry:insert-query name="QueryDocumentosD2"/>
                    </qry:if>
                </qry:if>
            </qry:if>
            <qry:element name="documentoD2">
                <qry:set-variable name="t_doc_saldo" value="0"/>
                <qry:for-each-row  doc="$TBL_documentos:">
                    <qry:element name="item">
                        <qry:set-variable name="nro_linea" value="1" operation="+"/>
                        <qry:set-variable name="t_doc_saldo" value="#ROW:/ROW/@DOC_SALDO" operation="+"/> 
                        <qry:if left="{$srv_cod}" operator="greater" right="0" type="integer">
                            <qry:attribute name="srv_cod" value="$srv_cod" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>
                        <qry:if left="{$cnt_num}" operator="greater" right="0" type="integer">
                            <qry:attribute name="cnt_num" value="$cnt_num" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>
                        <qry:attribute name="tipo" value="{#ROW:/ROW/@DOC_TIPO}" length="3" align="left"/>
                        <qry:if left="#ROW:/ROW/@DOC_TIPO" operator="equal" right="FN" type="string">
                            <qry:set-variable name="Tiene_Comprobantes_Financiaciones" value="1" operation="+"/>
                        <qry:else/>
                            <qry:if left="#ROW:/ROW/@DOC_TIPO" operator="equal" right="DN" type="string">
                                <qry:set-variable name="Tiene_Comprobantes_Financiaciones" value="1" operation="+"/>
                            <qry:else/>
                                <qry:set-variable name="Tiene_Otros_Comprobantes" value="1" operation="+"/>
                            </qry:if>
                        </qry:if> 
                        <qry:if left="#ROW:/ROW/@DOC_NUMERO" operator="greater" right="0" type="integer">
                            <qry:attribute name="numero" value="#ROW:/ROW/@DOC_NUMERO" length="12" align="left"/>
                            <qry:set-variable name="CantidadDeFacturas" value="1" operation="+"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>   
                        <qry:attribute name="fecha_emision" value="#ROW:/ROW/@DOC_FECHA_EMISION" length="12" align="left"/>        
                        <qry:if left="#ROW:/ROW/@DOC_PERIODO" operator="greater" right="0" type="integer">
                            <qry:attribute name="periodo" value="{#ROW:/ROW/@DOC_PERIODO}/{#ROW:/ROW/@DOC_ANIO}" length="9" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>               
                        <qry:if left="#ROW:/ROW/@DOC_ANIO" operator="greater" right="0" type="integer">
                            <qry:attribute name="anio" value="#ROW:/ROW/@DOC_ANIO" length="5" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>              
                        <qry:if left="#ROW:/ROW/@DOC_CUOTA" operator="greater" right="0" type="integer">
                            <qry:attribute name="cuota" value="#ROW:/ROW/@DOC_CUOTA" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>                  
                        <qry:attribute name="tipo_origen" value="#ROW:/ROW/@DOC_TIPO_ORIGEN" length="3" align="left"/>                    
                        <qry:if left="#ROW:/ROW/@DOC_NUMERO_ORIGEN" operator="greater" right="0" type="string">
                            <qry:attribute name="numero_origen" value="#ROW:/ROW/@DOC_NUMERO_ORIGEN" length="12" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>                           
                        <qry:if left="#ROW:/ROW/@DOC_CONSUMO" operator="greater" right="0" type="integer">
                            <qry:attribute name="consumo" value="#ROW:/ROW/@DOC_CONSUMO" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>                                
                        <qry:if left="#ROW:/ROW/@ORD_NUMERO" operator="greater" right="0" type="integer">
                            <qry:attribute name="ord_numero" value="#ROW:/ROW/@ORD_NUMERO" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>                                 
                        <qry:attribute name="urc_codigo" value="#ROW:/ROW/@URC_CODIGO" align="left"/>                                          
                        <qry:if left="#ROW:/ROW/@ASI_NUMERO" operator="greater" right="0" type="integer">
                            <qry:attribute name="asi_numero" value="#ROW:/ROW/@ASI_NUMERO" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                        </qry:if>                                              
                        <qry:attribute name="importe" value="#ROW:/ROW/@DOC_IMPORTE" align="left" format-number=" 2"/>
                        <qry:set-variable name="ImporteDelAviso" value="#ROW:/ROW/@DOC_IMPORTE_BASICO" operation="+"/>                                                  
                        <qry:attribute name="importe_basico" value="#ROW:/ROW/@DOC_IMPORTE_BASICO" align="left" format-number=" 2"/>                                                      
                        <qry:attribute name="saldo" value="#ROW:/ROW/@DOC_SALDO" length="12" align="right" format-number=" 2"/>                                                        
                        <qry:attribute name="fecha_venc" value="#ROW:/ROW/@DOC_FECHA_VENC" length="12" align="left"/>                                                              
                        <qry:attribute name="fecha_venc_1" value="#ROW:/ROW/@DOC_FECHA_VENC_1" length="12" align="left"/>                                                                
                        <qry:attribute name="fecha_venc_2" value="#ROW:/ROW/@DOC_FECHA_VENC_2" length="12" align="left"/>                                                                   
                        <qry:attribute name="recargo_venc_2" value="#ROW:/ROW/@DOC_RECARGO_VENC_2" align="left" format-number=" 2"/>                                                                           
                        <qry:attribute name="recargo_venc_3" value="#ROW:/ROW/@DOC_RECARGO_VENC_3" align="left" format-number=" 2"/>                                                                              
                        <qry:attribute name="estado" value="#ROW:/ROW/@DOC_ESTADO" align="left"/>                                                                                   
                        <qry:attribute name="llamada_sit_x" value="#ROW:/ROW/@LLAMADA_SIT_X" length="3" align="left"/>
                    </qry:element>
                </qry:for-each-row>
                <!--<qry:set-variable name="num_rows_doc" value="1" operation="-"/>-->
                <qry:while left="$nro_linea" operator="less" right="$num_rows_doc" type="integer">
                    <qry:element name="item">
				        <qry:set-variable name="nro_linea" value="1" operation="+"/>
				        <qry:attribute name="sin_datos" value="" length="12" align="left"/>
                    </qry:element>
			    </qry:while>
                <qry:attribute name="saldo_total" value="{$t_doc_saldo}" format-number=" 2"/>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="QueryDocumentosD2">
        <qry:select dump="0">
            SELECT /*+ rule */ TO_CHAR(DOC_NUMERO) AS DOC_NUMERO
            	,DOC_TIPO
            	,to_char(DOC_FECHA_EMISION, 'dd/mm/yyyy') AS DOC_FECHA_EMISION
            	,COALESCE(DOC_PERIODO, 0) AS DOC_PERIODO
            	,COALESCE(DOC_ANIO, 0) AS DOC_ANIO
            	,COALESCE(DOC_CUOTA, 0) AS DOC_CUOTA
            	,COALESCE(DOC_TIPO_ORIGEN, '0') AS DOC_TIPO_ORIGEN
            	,TO_CHAR(COALESCE(DOC_NUMERO_ORIGEN, 0)) AS DOC_NUMERO_ORIGEN
            	,COALESCE(DOC_CONSUMO, 0) AS DOC_CONSUMO
            	,COALESCE(ORD_NUMERO, 0) AS ORD_NUMERO
            	,COALESCE(URC_CODIGO, 0) AS URC_CODIGO
            	,COALESCE(ASI_NUMERO, 0) AS ASI_NUMERO
            	,TO_CHAR(DOC_IMPORTE, '9999999999990.0000') AS DOC_IMPORTE
            	,TO_CHAR(COALESCE(DOC_IMPORTE_BASICO, 0), '9999999999990.0000') AS DOC_IMPORTE_BASICO
            	,TO_CHAR(nvl(DOC_SALDO, DOC_IMPORTE), '9999999999990.0000') AS DOC_SALDO
            	,COALESCE(to_char(DOC_FECHA_VENC, 'dd/mm/yy'), '0') AS DOC_FECHA_VENC
            	,COALESCE(to_char(DOC_FECHA_VENC_1, 'dd/mm/yyyy'), '0') AS DOC_FECHA_VENC_1
            	,COALESCE(to_char(DOC_FECHA_VENC_2, 'dd/mm/yyyy'), '0') AS DOC_FECHA_VENC_2
            	,TO_CHAR(COALESCE(DOC_RECARGO_VENC_2, 0), '9999999999990.0000') AS DOC_RECARGO_VENC_2
            	,COALESCE(to_char(DOC_FECHA_VENC_3, 'dd/mm/yyyy'), '0') AS DOC_FECHA_VENC_3
            	,TO_CHAR(COALESCE(DOC_RECARGO_VENC_3, 0), '9999999999990.0000') AS DOC_RECARGO_VENC_3
            	,DOC_ESTADO
            	,decode(doc_situacion, 'X', '(*)', 'C1', '(*)', 'C2', '(*)', 'C3', '(*)', '   ') LLAMADA_SIT_X
            FROM DOCUMENTOS
            WHERE TRT_NUMERO = {$trt_num}
            	AND NVL(NVL(DOC_SALDO, DOC_IMPORTE), 0) &gt; 0
            	AND doc_situacion &lt;&gt; 'X'
                AND ROWNUM &lt; {$num_rows_doc}
            ORDER BY DOC_FECHA_VENC_1
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_trt_num" value="{$trt_num}"/>
            <qry:set-variable name="TBL_documentos" value="#ROW:"/>
            <qry:if left="document_tbl_type" operator="equal" right="DOC" type="string">
                <qry:set-variable name="isEmpty_documentos_doc" value="1"/>
                <qry:set-variable name="isEmpty_documentos_ori" value="0"/>
            <qry:else/>
                <qry:set-variable name="isEmpty_documentos_ori" value="1"/>
                <qry:set-variable name="isEmpty_documentos_doc" value="0"/>
            </qry:if>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Totales_Tramite"> 
        <qry:out>
            <qry:if left="$isEmpty_totales_tramites" operator="equal" right="0" type="integer">
                <qry:insert-query name="QueryTotales_Tramite"/>
            <qry:else/>
                <qry:if left="{$actual_trt_num}" operator="equal" right="{$trt_num}" type="integer">
                    <qry:insert-query name="QueryTotales_Tramite"/>
                </qry:if>
            </qry:if>
            <qry:element name="totalesTramite">
                <qry:for-each-row  doc="$TBL_totales_tramites:">    
                    <qry:if left="{$v_columna}" operator="equal" right="TTR_CANT_DOC" type="string">
                        <qry:attribute name="cant_doc" value="#ROW:/ROW/@TTR_CANT_DOC" length="$largos" align="left"/>
			        </qry:if>
                    <qry:if left="{$v_columna}" operator="equal" right="TTR_SUMA_DOC" type="string">
			    		<qry:attribute name="suma_doc" value="#ROW:/ROW/@TTR_SUMA_DOC" length="$largos" align="left" format-number=" 2"/>
			        </qry:if>
                    <qry:if left="{$v_columna}" operator="equal" right="TTR_SUMA_DEC" type="string">
                        <qry:if left="#ROW:/ROW/@TTR_SUMA_DEC" operator="not-equal" right="0" type="integer">
                            <qry:attribute name="suma_dec" value="#ROW:/ROW/@TTR_SUMA_DEC_MESSG" length="$largos" align="left"/>
                        <qry:else/>
                            <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
                        </qry:if>
			        </qry:if>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <qry:query name="QueryTotales_Tramite" > 
        <qry:select dump="0">
            SELECT TTR_CANT_DOC AS TTR_CANT_DOC
                ,TO_CHAR(TTR_SUMA_DOC, '9999999999990.0000') AS TTR_SUMA_DOC
                ,TTR_SUMA_DEC AS TTR_SUMA_DEC
                ,('Deuda Cargo Decreto N^176!. 2067/08: ' || TO_CHAR(TTR_SUMA_DEC, '9999999999999D99') || '(*)\n') AS TTR_SUMA_DEC_MESSG
            FROM TOTALES_TRAMITE
            WHERE TRT_NUMERO = {$trt_num}
        </qry:select>
        <qry:out>
            <qry:set-variable name="actual_trt_num" value="{$trt_num}"/>
            <qry:set-variable name="TBL_totales_tramites" value="#ROW:"/>
            <qry:set-variable name="isEmpty_totales_tramites" value="1"/>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Usuarios"> 
        <qry:select dump="0">
            SELECT S.SCF_DESCRIPCION AS SCF_DESCRIPCION
            FROM SUCURSALES S
            INNER JOIN USUARIOS U
              ON U.SCF_CODIGO = S.SCF_CODIGO
            WHERE U.USR_CODIGO = USER
        </qry:select>
        <qry:out>
            <qry:element name="usuarios" >
                <qry:for-each-row>
                    <qry:if left="{$v_columna}" operator="equal" right="SCF_CODIGO" type="string">
                        <qry:attribute name="descripcion" value="#ROW:/ROW/@SCF_DESCRIPCION" length="$largos" align="left"/>
                    <qry:else/>
                        <qry:attribute name="sin_datos" value="" length="$largos" align="left"/>
		            </qry:if>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="Prs_Num_Ori"> 
        <qry:select dump="0">
            SELECT PRS_NUMERO
            FROM CONTRATOS
            WHERE CNT_NUMERO = {$cnt_num}
	            AND SRV_CODIGO = {$srv_cod}
        </qry:select>
        <qry:out>
            <qry:element name="prsNumOri">
                <qry:for-each-row>
                    <qry:set-variable name="prs_num_temp" value="{$prs_num}"/>
                    <qry:set-variable name="prs_num" value="#ROW:/ROW/@PRS_NUMERO"/>
                    <qry:attribute name="num_ori" value="#ROW:/ROW/@PRS_NUMERO"/>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>

    <!-- COMPLETADO: Probado -->
    <qry:query name="SelectCodigoBarras"> 
        <qry:select dump="0">
            SELECT LPAD({$nro_ord}, 10, '0') AS NRO_ORD
                ,LPAD('81', 2, '0') AS COD_EMPRESA
                ,LPAD('87', 2, '0') AS TIPO_COMPROBANTE
                ,LPAD({$nro_ord}, 10, '0') AS NRO_COMPROBANTE
                ,LPAD((REPLACE('123454.54', '.')), 12, '0') AS IMPORTE
                ,LPAD((REPLACE({$sysdate}, '/')), 8, '0') AS FECHA_LIMITE_1
                ,LPAD((REPLACE({$sysdate}, '/')), 8, '0') AS FECHA_LIMITE_2
                ,LPAD('1', 1, '0') AS TIPO_FACTURA
                ,LPAD('0', 1, '0') AS DIGITO_VERIFICADOR
            FROM DUAL
        </qry:select>
        <qry:out>
            <!-- TODO -->
            <!-- Como hacer con el tema de la impresion del codigo de barras -->
            <qry:element name="codigoBarras" >
                <qry:for-each-row>
                    <qry:print output="stdout" value="                                  TEST: Fecha {$sysdate}"/>
                    <qry:attribute name="barras_litoral" value="{#ROW:/ROW/@COD_EMPRESA}{#ROW:/ROW/@TIPO_COMPROBANTE}{#ROW:/ROW/@NRO_COMPROBANTE}{#ROW:/ROW/@IMPORTE}{#ROW:/ROW/@FECHA_LIMITE_1}{#ROW:/ROW/@FECHA_LIMITE_2}{#ROW:/ROW/@TIPO_FACTURA}{#ROW:/ROW/@DIGITO_VERIFICADOR}" length="44" align="left"/>
                    <qry:set-variable name="nrobarra" value="#ROW:/ROW/@NRO_ORD"/>
                    <qry:attribute name="barras_correo" value="#ROW:/ROW/@NRO_ORD" length="10" align="left"/>
                </qry:for-each-row>
            </qry:element>
        </qry:out>
    </qry:query>
    
    <!-- COMPLETADO: Probado -->
    <qry:query name="Buscar_Codigos_Control"> 
        <qry:select dump="0">
            <!-- Cuando es nulo en Pro*C se coloca 0 -->
            SELECT COALESCE(TIM_CODIGO_CONTROL_1, '') AS TIM_CODIGO_CONTROL_1
              ,COALESCE(TIM_CODIGO_CONTROL_2, '') AS TIM_CODIGO_CONTROL_2
              ,COALESCE(TIM_CODIGO_CONTROL_3, '') AS TIM_CODIGO_CONTROL_3
              ,COALESCE(TIM_CODIGO_CONTROL_4, '') AS TIM_CODIGO_CONTROL_4
              ,COALESCE(TIM_CODIGO_CONTROL_5, '') AS TIM_CODIGO_CONTROL_5
              ,COALESCE(TIM_CODIGO_CONTROL_6, '') AS TIM_CODIGO_CONTROL_6
              ,COALESCE(TIM_CODIGO_CONTROL_7, '') AS TIM_CODIGO_CONTROL_7
              ,COALESCE(TIM_CODIGO_CONTROL_8, '') AS TIM_CODIGO_CONTROL_8
              ,COALESCE(TIM_CODIGO_CONTROL_9, '') AS TIM_CODIGO_CONTROL_9
              ,COALESCE(TIM_CODIGO_CONTROL_10, '') AS TIM_CODIGO_CONTROL_10
              ,COALESCE(TIM_CODIGO_CONTROL_11, '') AS TIM_CODIGO_CONTROL_11
              ,COALESCE(TIM_CODIGO_CONTROL_12, '') AS TIM_CODIGO_CONTROL_12
              ,COALESCE(TIM_CODIGO_CONTROL_13, '') AS TIM_CODIGO_CONTROL_13
              ,COALESCE(TIM_CODIGO_CONTROL_14, '') AS TIM_CODIGO_CONTROL_14
              ,COALESCE(TIM_CODIGO_CONTROL_15, '') AS TIM_CODIGO_CONTROL_15
            FROM TIPOS_IMPRESORA
            WHERE TIM_CODIGO = {$v_tim_codigo}
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:element name="codigoControl">
                    <qry:attribute name="tim_codigo_control_1" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_1" align="left"/>
                    <qry:attribute name="tim_codigo_control_2" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_2" align="left"/>
                    <qry:attribute name="tim_codigo_control_3" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_3" align="left"/>
                    <qry:attribute name="tim_codigo_control_4" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_4" align="left"/>
                    <qry:attribute name="tim_codigo_control_5" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_5" align="left"/>
                    <qry:attribute name="tim_codigo_control_6" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_6" align="left"/>
                    <qry:attribute name="tim_codigo_control_7" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_7" align="left"/>
                    <qry:attribute name="tim_codigo_control_8" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_8" align="left"/>
                    <qry:attribute name="tim_codigo_control_9" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_9" align="left"/>
                    <qry:attribute name="tim_codigo_control_10" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_10" align="left"/>
                    <qry:attribute name="tim_codigo_control_11" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_11" align="left"/>
                    <qry:attribute name="tim_codigo_control_12" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_12" align="left"/>
                    <qry:attribute name="tim_codigo_control_13" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_13" align="left"/>
                    <qry:attribute name="tim_codigo_control_14" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_14" align="left"/>
                    <qry:attribute name="tim_codigo_control_15" value="#ROW:/ROW/@TIM_CODIGO_CONTROL_15" align="left"/>
                </qry:element>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

    <qry:query name="Completa_Vacio_Cero" > 
        <qry:select dump="0">
            SELECT RPAD(' ', {$largos} - 1) || '0' AS EMPTY
            FROM DUAL
        </qry:select>
        <qry:out>
            <qry:for-each-row>
                <qry:set-variable name="campo" value="#ROW:/ROW/@EMPTY"/>
            </qry:for-each-row>
        </qry:out>
    </qry:query>

</qry:doc-definition>